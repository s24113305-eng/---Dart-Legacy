<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dart Legacy Ultimate - Carnival Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Londrina+Solid:wght@400;900&family=Bangers&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Londrina Solid', cursive; overflow: hidden; height: 100vh; cursor: default; }
        .game-container { width: 100%; height: 100vh; position: relative; overflow: hidden; }
        
        /* Carnival Background */
        .carnival-bg {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(180deg, #1a0a2e 0%, #16213e 50%, #0f3460 100%);
            z-index: 0;
        }
        
        .tent-top {
            position: absolute;
            top: 0; left: 0; right: 0;0
            height: 80px;
            background: repeating-linear-gradient(90deg, #e63946 0px, #e63946 60px, #f1faee 60px, #f1faee 120px);
            clip-path: polygon(0 0, 100% 0, 100% 60%, 50% 100%, 0 60%);
            z-index: 1;
        }
        
        .string-lights { position: absolute; top: 70px; left: 0; right: 0; height: 30px; z-index: 2; }
        .light-bulb { position: absolute; width: 12px; height: 16px; border-radius: 50%; animation: glow 1s ease-in-out infinite alternate; }
        @keyframes glow { 0% { filter: brightness(1); } 100% { filter: brightness(1.5); box-shadow: 0 0 15px currentColor; } }
        
        .toy-shelf {
            position: absolute; bottom: 0; left: 0; right: 0; height: 100px;
            background: linear-gradient(0deg, #8B4513 0%, #A0522D 100%);
            border-top: 8px solid #654321; z-index: 1;
            display: flex; justify-content: space-around; align-items: flex-end; padding: 0 20px 8px;
        }
        
        .stuffed-toy { font-size: 40px; filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5)); animation: toyBob 2s ease-in-out infinite; transition: transform 0.3s; }
        .stuffed-toy:nth-child(odd) { animation-delay: 0.5s; }
        .stuffed-toy.won { animation: toyWin 0.5s ease; }
        @keyframes toyBob { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes toyWin { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.5); } }
        
        .bg-balloon { position: absolute; font-size: 35px; opacity: 0.5; z-index: 0; animation: floatUp linear infinite; }
        @keyframes floatUp { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 10% { opacity: 0.5; } 90% { opacity: 0.5; } 100% { transform: translateY(-100px) rotate(20deg); opacity: 0; } }
        
        .prize-display { position: absolute; top: 100px; width: 70px; height: 280px; background: linear-gradient(180deg, #FFD700 0%, #FFA500 100%); border: 4px solid #8B4513; border-radius: 10px; display: flex; flex-direction: column; align-items: center; padding-top: 8px; gap: 12px; z-index: 1; }
        .prize-display.left { left: 8px; }
        .prize-display.right { right: 8px; }
        .prize-toy { font-size: 28px; }
        
        /* Main Menu */
        .main-menu { width: 100%; height: 100vh; position: relative; display: flex; flex-direction: column; align-items: center; background: linear-gradient(180deg, #1a0a2e 0%, #2d1b4e 30%, #e63946 70%, #FFD700 100%); cursor: default; overflow-y: auto; padding: 20px 0; overflow-x: hidden; z-index: 100; }
        
        /* Hot Air Balloon in Main Menu Background */
        .menu-hot-air-balloon {
            position: absolute;
            width: 150px;
            height: auto;
            z-index: 1;
            pointer-events: none;
            animation: floatBalloon 20s ease-in-out infinite;
            filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.3));
        }
        
        .menu-hot-air-balloon.balloon1 {
            top: 10%;
            left: -150px;
            animation: floatBalloon1 25s ease-in-out infinite;
        }
        
        .menu-hot-air-balloon.balloon2 {
            top: 40%;
            right: -150px;
            width: 100px;
            animation: floatBalloon2 30s ease-in-out infinite;
            animation-delay: -10s;
        }
        
        .menu-hot-air-balloon.balloon3 {
            top: 60%;
            left: -150px;
            width: 120px;
            animation: floatBalloon3 22s ease-in-out infinite;
            animation-delay: -5s;
        }
        
        @keyframes floatBalloon1 {
            0% { transform: translate(0, 0); left: -150px; }
            50% { transform: translate(calc(100vw + 150px), -50px); }
            50.01% { transform: translate(calc(100vw + 150px), 30px); left: -150px; }
            100% { transform: translate(0, 0); }
        }
        
        @keyframes floatBalloon2 {
            0% { transform: translate(0, 0); right: -150px; }
            50% { transform: translate(calc(-100vw - 150px), 40px); }
            50.01% { transform: translate(calc(-100vw - 150px), -30px); right: -150px; }
            100% { transform: translate(0, 0); }
        }
        
        @keyframes floatBalloon3 {
            0% { transform: translate(0, 0) rotate(-3deg); left: -150px; }
            25% { transform: translate(calc(50vw), -30px) rotate(3deg); }
            50% { transform: translate(calc(100vw + 150px), 20px) rotate(-3deg); }
            50.01% { left: -150px; transform: translate(0, 0) rotate(3deg); }
            100% { transform: translate(0, 0) rotate(-3deg); }
        }
        
        /* Fake Clouds in Main Menu */
        .menu-cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            z-index: 0;
            pointer-events: none;
            filter: blur(2px);
        }
        
        .menu-cloud::before,
        .menu-cloud::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
        }
        
        .menu-cloud.cloud1 {
            width: 120px;
            height: 50px;
            top: 8%;
            animation: cloudFloat1 35s linear infinite;
        }
        .menu-cloud.cloud1::before { width: 60px; height: 45px; top: -20px; left: 20px; }
        .menu-cloud.cloud1::after { width: 70px; height: 40px; top: -15px; right: 15px; }
        
        .menu-cloud.cloud2 {
            width: 150px;
            height: 60px;
            top: 25%;
            animation: cloudFloat2 40s linear infinite;
            animation-delay: -15s;
        }
        .menu-cloud.cloud2::before { width: 80px; height: 55px; top: -25px; left: 25px; }
        .menu-cloud.cloud2::after { width: 90px; height: 50px; top: -20px; right: 20px; }
        
        .menu-cloud.cloud3 {
            width: 100px;
            height: 40px;
            top: 15%;
            animation: cloudFloat3 30s linear infinite;
            animation-delay: -8s;
        }
        .menu-cloud.cloud3::before { width: 50px; height: 35px; top: -15px; left: 15px; }
        .menu-cloud.cloud3::after { width: 55px; height: 30px; top: -12px; right: 10px; }
        
        .menu-cloud.cloud4 {
            width: 180px;
            height: 70px;
            top: 35%;
            animation: cloudFloat1 45s linear infinite;
            animation-delay: -20s;
            opacity: 0.6;
        }
        .menu-cloud.cloud4::before { width: 100px; height: 60px; top: -30px; left: 30px; }
        .menu-cloud.cloud4::after { width: 110px; height: 55px; top: -25px; right: 25px; }
        
        .menu-cloud.cloud5 {
            width: 90px;
            height: 35px;
            top: 45%;
            animation: cloudFloat3 28s linear infinite;
            animation-delay: -12s;
            opacity: 0.5;
        }
        .menu-cloud.cloud5::before { width: 45px; height: 30px; top: -12px; left: 12px; }
        .menu-cloud.cloud5::after { width: 50px; height: 28px; top: -10px; right: 8px; }
        
        @keyframes cloudFloat1 {
            0% { left: -200px; }
            100% { left: calc(100vw + 50px); }
        }
        
        @keyframes cloudFloat2 {
            0% { right: -250px; }
            100% { right: calc(100vw + 50px); }
        }
        
        @keyframes cloudFloat3 {
            0% { left: -150px; }
            100% { left: calc(100vw + 50px); }
        }
        .carnival-stripe { position: absolute; top: 0; left: 0; right: 0; height: 50px; background: repeating-linear-gradient(45deg, #e63946, #e63946 20px, #f1faee 20px, #f1faee 40px); border-bottom: 6px solid #8B4513; }
        
        .title-container { text-align: center; margin-top: 60px; margin-bottom: 15px; z-index: 10; }
        .title { font-family: 'Bangers', cursive; font-size: 60px; color: #FFD700; text-shadow: 3px 3px 0 #e63946, 6px 6px 0 #000; letter-spacing: 4px; animation: titleBounce 2s ease-in-out infinite; }
        .subtitle { font-family: 'Fredoka One', cursive; font-size: 18px; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .version-tag { font-family: 'Bangers', cursive; font-size: 14px; color: #FFD700; background: #e63946; padding: 4px 12px; border-radius: 15px; margin-top: 5px; display: inline-block; }
        @keyframes titleBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        
        /* Language Selector */
        .language-selector { display: flex; gap: 10px; margin-bottom: 15px; z-index: 10; }
        .lang-btn { padding: 8px 20px; font-family: 'Bangers', cursive; font-size: 16px; border: 3px solid #8B4513; border-radius: 10px; background: linear-gradient(135deg, #FFD700, #FFA500); color: #8B4513; cursor: pointer; transition: all 0.3s; box-shadow: 0 3px 0 #654321; }
        .lang-btn:hover { transform: translateY(-2px); }
        .lang-btn.active { background: linear-gradient(135deg, #e63946, #FF1493); color: #fff; border-color: #8B0000; box-shadow: 0 3px 0 #8B0000; }
        
        /* Mode Cards Container */
        .mode-cards-container { display: flex; gap: 15px; margin-bottom: 15px; z-index: 10; flex-wrap: wrap; justify-content: center; max-width: 900px; padding: 0 10px; }
        
        /* Mode Card */
        .mode-card { width: 200px; background: linear-gradient(180deg, #2a2a5a 0%, #1a1a3a 100%); border: 4px solid #4ECDC4; border-radius: 15px; padding: 12px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
        .mode-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .mode-card.active { border-color: #FFD700; box-shadow: 0 0 20px rgba(255,215,0,0.5); }
        .mode-card.vs-card { border-color: #FF1493; }
        .mode-card.vs-card.active { border-color: #FFD700; }
        
        /* Animated Mode Scene */
        .mode-scene {
            height: 90px;
            background: linear-gradient(180deg, #0a0a2a 0%, #1a1a4a 60%, #2a1a3a 100%);
            border-radius: 10px;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        .mode-scene::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(0deg, #3a2a4a 0%, transparent 100%);
        }
        
        /* Scene elements */
        .scene-char {
            position: absolute;
            font-size: 36px;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5));
            z-index: 5;
        }
        
        .scene-item {
            position: absolute;
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));
        }
        
        .scene-ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 15px;
            background: linear-gradient(0deg, #4a3a5a 0%, #3a2a4a 100%);
        }
        
        /* Classic Mode Scene - Bear throwing dart */
        .mode-card[data-mode="classic"] .scene-char.bear {
            bottom: 15px;
            left: 15%;
            animation: classicBearThrow 2s ease-in-out infinite;
        }
        
        @keyframes classicBearThrow {
            0%, 100% { transform: rotate(0deg); }
            20% { transform: rotate(-25deg) translateY(-5px); }
            40% { transform: rotate(15deg); }
            60%, 80% { transform: rotate(0deg); }
        }
        
        .mode-card[data-mode="classic"] .scene-item.dart {
            font-size: 20px;
            animation: classicDartFly 2s ease-in-out infinite;
        }
        
        @keyframes classicDartFly {
            0%, 30% { left: 35%; top: 50%; opacity: 0; transform: rotate(45deg) scale(0.5); }
            40% { left: 35%; top: 45%; opacity: 1; transform: rotate(45deg) scale(1); }
            70% { left: 75%; top: 25%; opacity: 1; transform: rotate(45deg) scale(1); }
            75%, 100% { left: 78%; top: 22%; opacity: 0; transform: rotate(45deg) scale(0.5); }
        }
        
        .mode-card[data-mode="classic"] .scene-item.target {
            font-size: 40px;
            right: 8px;
            top: 10px;
            animation: classicTargetSpin 3s linear infinite, classicTargetHit 2s ease-in-out infinite;
        }
        
        @keyframes classicTargetSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes classicTargetHit {
            0%, 65% { filter: drop-shadow(0 0 5px transparent); }
            70%, 80% { filter: drop-shadow(0 0 15px #FFD700); }
            85%, 100% { filter: drop-shadow(0 0 5px transparent); }
        }
        
        .mode-card[data-mode="classic"] .scene-item.balloon {
            font-size: 16px;
            animation: floatBalloon 2s ease-in-out infinite;
        }
        
        @keyframes floatBalloon {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .mode-card[data-mode="classic"] .scene-item.pop {
            font-size: 14px;
            animation: popEffect 2s ease-in-out infinite;
        }
        
        @keyframes popEffect {
            0%, 65% { opacity: 0; transform: scale(0); }
            70% { opacity: 1; transform: scale(1.5); }
            85%, 100% { opacity: 0; transform: scale(2); }
        }
        
        /* Time Attack Scene - Mouse running fast */
        .mode-card[data-mode="timeAttack"] .scene-char.mouse {
            bottom: 15px;
            animation: timeMouseRun 0.8s ease-in-out infinite;
        }
        
        @keyframes timeMouseRun {
            0% { left: 5%; transform: scaleX(1) translateY(0); }
            25% { transform: scaleX(1) translateY(-12px); }
            50% { left: 25%; transform: scaleX(1) translateY(0); }
            75% { transform: scaleX(1) translateY(-12px); }
            100% { left: 5%; transform: scaleX(1) translateY(0); }
        }
        
        .mode-card[data-mode="timeAttack"] .scene-item.clock {
            font-size: 35px;
            right: 10px;
            top: 8px;
            animation: clockPanic 0.3s ease-in-out infinite;
        }
        
        @keyframes clockPanic {
            0%, 100% { transform: rotate(-8deg) scale(1); }
            50% { transform: rotate(8deg) scale(1.1); }
        }
        
        .mode-card[data-mode="timeAttack"] .scene-item.balloon {
            font-size: 18px;
            animation: timeBalloonPop 1.5s ease-in-out infinite;
        }
        
        .mode-card[data-mode="timeAttack"] .scene-item.balloon.b1 { left: 40%; top: 15%; animation-delay: 0s; }
        .mode-card[data-mode="timeAttack"] .scene-item.balloon.b2 { left: 55%; top: 25%; animation-delay: 0.3s; }
        .mode-card[data-mode="timeAttack"] .scene-item.balloon.b3 { left: 70%; top: 18%; animation-delay: 0.6s; }
        
        @keyframes timeBalloonPop {
            0%, 70% { transform: scale(1); opacity: 1; }
            80% { transform: scale(1.4); opacity: 0.5; }
            90%, 100% { transform: scale(0); opacity: 0; }
        }
        
        .mode-card[data-mode="timeAttack"] .scene-item.speed-lines {
            font-size: 12px;
            color: #FFD700;
            font-family: 'Bangers', cursive;
            animation: speedLines 0.4s linear infinite;
        }
        
        /* Time to Attack Scene - Combined mode */
        .mode-card[data-mode="timeToAttack"] .scene-char.mouse {
            bottom: 15px;
            left: 10%;
            animation: timeMouseRun 0.8s ease-in-out infinite;
        }
        
        .mode-card[data-mode="timeToAttack"] .scene-item.clock {
            font-size: 35px;
            right: 10px;
            top: 8px;
            animation: clockPanic 0.3s ease-in-out infinite;
        }
        
        .mode-card[data-mode="timeToAttack"] .scene-item.bomb {
            font-size: 28px;
            animation: bombFall 1.5s ease-in infinite;
        }
        
        .mode-card[data-mode="timeToAttack"] .scene-item.bomb.b1 { right: 20%; animation-delay: 0s; }
        .mode-card[data-mode="timeToAttack"] .scene-item.bomb.b2 { right: 50%; animation-delay: 0.5s; }
        
        .mode-card[data-mode="timeToAttack"] .scene-item.heart {
            font-size: 18px;
            top: 8px;
            animation: heartPulse 0.8s ease-in-out infinite;
        }
        
        .mode-card[data-mode="timeToAttack"] .scene-item.heart.h1 { left: 8px; animation-delay: 0s; }
        .mode-card[data-mode="timeToAttack"] .scene-item.heart.h2 { left: 28px; animation-delay: 0.15s; }
        .mode-card[data-mode="timeToAttack"] .scene-item.heart.h3 { left: 48px; animation-delay: 0.3s; }
        
        .mode-card[data-mode="timeToAttack"] .scene-item.speed-lines {
            font-size: 12px;
            color: #FFD700;
            font-family: 'Bangers', cursive;
            animation: speedLines 0.4s linear infinite;
        }
        
        /* Survival Scene - Cat dodging bombs */
        .mode-card[data-mode="survival"] .scene-char.cat {
            bottom: 15px;
            left: 30%;
            animation: catDodge 1.5s ease-in-out infinite;
        }
        
        @keyframes catDodge {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            20% { transform: translateX(-25px) rotate(-10deg); }
            50% { transform: translateX(0) rotate(0deg); }
            70% { transform: translateX(25px) rotate(10deg); }
        }
        
        .mode-card[data-mode="survival"] .scene-item.bomb {
            font-size: 28px;
            animation: bombFall 1.5s ease-in infinite;
        }
        
        .mode-card[data-mode="survival"] .scene-item.bomb.b1 { right: 20%; animation-delay: 0s; }
        .mode-card[data-mode="survival"] .scene-item.bomb.b2 { right: 50%; animation-delay: 0.5s; }
        
        @keyframes bombFall {
            0% { top: -20px; opacity: 1; transform: rotate(0deg); }
            80% { top: 60px; opacity: 1; transform: rotate(360deg); }
            85% { transform: scale(1.3) rotate(360deg); }
            100% { top: 60px; opacity: 0; transform: scale(0) rotate(360deg); }
        }
        
        .mode-card[data-mode="survival"] .scene-item.heart {
            font-size: 18px;
            top: 8px;
            animation: heartPulse 0.8s ease-in-out infinite;
        }
        
        .mode-card[data-mode="survival"] .scene-item.heart.h1 { left: 8px; animation-delay: 0s; }
        .mode-card[data-mode="survival"] .scene-item.heart.h2 { left: 28px; animation-delay: 0.15s; }
        .mode-card[data-mode="survival"] .scene-item.heart.h3 { left: 48px; animation-delay: 0.3s; }
        
        @keyframes heartPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.25); }
        }
        
        .mode-card[data-mode="survival"] .scene-item.sweat {
            font-size: 12px;
            animation: sweatDrop 1s ease-in infinite;
        }
        
        /* VS Mode Scene - Bear vs Rabbit battle */
        .mode-card[data-mode="versus"] .scene-char.bear {
            bottom: 15px;
            left: 12%;
            animation: vsBearReady 1s ease-in-out infinite;
        }
        
        @keyframes vsBearReady {
            0%, 100% { transform: translateX(0) rotate(-5deg); }
            50% { transform: translateX(8px) rotate(5deg); }
        }
        
        .mode-card[data-mode="versus"] .scene-char.rabbit {
            bottom: 15px;
            right: 12%;
            animation: vsRabbitReady 1s ease-in-out infinite;
        }
        
        @keyframes vsRabbitReady {
            0%, 100% { transform: translateX(0) rotate(5deg) scaleX(-1); }
            50% { transform: translateX(-8px) rotate(-5deg) scaleX(-1); }
        }
        
        .mode-card[data-mode="versus"] .scene-item.vs-text {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Bangers', cursive;
            font-size: 28px;
            color: #FFD700;
            text-shadow: 2px 2px 0 #e63946, -2px -2px 0 #e63946, 2px -2px 0 #e63946, -2px 2px 0 #e63946;
            animation: vsPulse 0.5s ease-in-out infinite;
            z-index: 10;
        }
        
        @keyframes vsPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(-3deg); }
            50% { transform: translate(-50%, -50%) scale(1.15) rotate(3deg); }
        }
        
        .mode-card[data-mode="versus"] .scene-item.lightning {
            font-size: 20px;
            animation: lightningFlash 0.8s ease-in-out infinite;
        }
        
        .mode-card[data-mode="versus"] .scene-item.lightning.l1 { left: 35%; top: 15%; animation-delay: 0s; }
        .mode-card[data-mode="versus"] .scene-item.lightning.l2 { right: 35%; top: 20%; animation-delay: 0.4s; }
        
        @keyframes lightningFlash {
            0%, 40%, 100% { opacity: 0; transform: scale(0.5); }
            50%, 60% { opacity: 1; transform: scale(1.2); }
        }
        
        .mode-card[data-mode="versus"] .scene-item.fire {
            font-size: 14px;
            animation: fireFlicker 0.3s ease-in-out infinite;
        }
        
        @keyframes fireFlicker {
            0%, 100% { transform: scaleY(1) scaleX(1); opacity: 1; }
            50% { transform: scaleY(1.2) scaleX(0.9); opacity: 0.8; }
        }
        
        @keyframes speedLines {
            0% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0.3; transform: translateX(-10px); }
        }
        
        @keyframes sweatDrop {
            0% { opacity: 0; transform: translateY(-5px); }
            50% { opacity: 1; transform: translateY(5px); }
            100% { opacity: 0; transform: translateY(15px); }
        }
        
        /* Tutorial Modal */
        .tutorial-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .tutorial-modal.active {
            display: flex;
        }
        
        .tutorial-content {
            background: linear-gradient(180deg, #1a1a3a 0%, #2a2a5a 100%);
            border: 5px solid #FFD700;
            border-radius: 25px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 50px rgba(255,215,0,0.3);
        }
        
        .tutorial-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #e63946, #c0392b);
            border: 3px solid #8B0000;
            border-radius: 12px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.3s, box-shadow 0.3s;
            padding: 10px 20px;
            font-family: 'Bangers', cursive;
            font-size: 18px;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        
        .tutorial-close:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(230,57,70,0.5);
        }
        
        /* Back to Menu Button in Game */
        .back-to-menu {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 500;
            cursor: pointer;
            background: linear-gradient(135deg, #e63946, #c0392b);
            border: 3px solid #8B0000;
            border-radius: 10px;
            padding: 10px 20px;
            font-family: 'Bangers', cursive;
            font-size: 18px;
            color: #fff;
            text-shadow: 2px 2px 2px rgba(0,0,0,0.5);
            box-shadow: 0 4px 0 #8B0000, 0 6px 10px rgba(0,0,0,0.3);
            transition: all 0.2s;
            pointer-events: auto;
        }
        
        .back-to-menu:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #8B0000, 0 8px 15px rgba(0,0,0,0.4);
            background: linear-gradient(135deg, #ff4757, #e63946);
        }
        
        .back-to-menu:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #8B0000;
        }
        
        /* Music Toggle Button */
        .music-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 150;
            cursor: pointer;
            background: rgba(0,0,0,0.6);
            border: 3px solid #FFD700;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .music-toggle:hover {
            transform: scale(1.1);
            background: rgba(255,215,0,0.3);
        }
        
        .music-toggle.muted {
            opacity: 0.5;
        }
        
        /* Cartoon Scene Container */
        .tutorial-scene {
            height: 350px;
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 60%, #90EE90 100%);
            border-radius: 20px 20px 0 0;
            position: relative;
            overflow: hidden;
        }
        
        /* Animated Video Tutorial */
        .video-tutorial {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow: hidden;
        }
        
        /* Sky and clouds */
        .tut-cloud {
            position: absolute;
            font-size: 40px;
            opacity: 0.8;
            animation: cloudFloat 20s linear infinite;
        }
        
        @keyframes cloudFloat {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(calc(100vw + 100px)); }
        }
        
        /* Ground/grass */
        .tut-ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(0deg, #228B22 0%, #32CD32 50%, #90EE90 100%);
            border-top: 4px solid #196619;
        }
        
        .tut-grass {
            position: absolute;
            bottom: 76px;
            font-size: 20px;
            color: #228B22;
        }
        
        /* Carnival booth */
        .tut-booth {
            position: absolute;
            bottom: 80px;
            right: 10%;
            width: 180px;
            height: 140px;
            background: linear-gradient(180deg, #DEB887 0%, #D2691E 100%);
            border-radius: 10px;
            border: 4px solid #8B4513;
        }
        
        .tut-booth::before {
            content: '';
            position: absolute;
            top: -30px;
            left: -15px;
            right: -15px;
            height: 40px;
            background: repeating-linear-gradient(90deg, #e63946 0px, #e63946 15px, #f1faee 15px, #f1faee 30px);
            border-radius: 10px 10px 0 0;
            border: 3px solid #8B4513;
        }
        
        /* Dartboard in booth */
        /* Balloons floating */
        .tut-balloon {
            position: absolute;
            font-size: 28px;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
            transition: all 0.3s;
        }
        
        /* Capybara character */
        .tut-capybara {
            position: absolute;
            bottom: 60px;
            left: 10%;
            width: 140px;
            height: auto;
            z-index: 50;
            transform-origin: center center;
            animation: capybaraFloat 3s ease-in-out infinite;
            filter: drop-shadow(3px 5px 8px rgba(0,0,0,0.3));
        }
        
        @keyframes capybaraFloat {
            0%, 100% { 
                transform: translateY(0) rotate(-2deg); 
            }
            25% { 
                transform: translateY(-15px) rotate(1deg); 
            }
            50% { 
                transform: translateY(-8px) rotate(2deg); 
            }
            75% { 
                transform: translateY(-20px) rotate(-1deg); 
            }
        }
        
        /* Different animation states */
        .tut-capybara.pointing {
            animation: capybaraPoint 1.5s ease-in-out infinite;
        }
        
        .tut-capybara.charging {
            animation: capybaraCharge 0.5s ease-in-out infinite;
        }
        
        .tut-capybara.throwing {
            animation: capybaraThrowAnim 0.6s ease-out;
        }
        
        .tut-capybara.celebrating {
            animation: capybaraCelebrate 0.5s ease-in-out infinite;
        }
        
        @keyframes capybaraPoint {
            0%, 100% { transform: translateY(-10px) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        @keyframes capybaraCharge {
            0%, 100% { transform: translateY(-5px) rotate(-8deg) scale(1); }
            50% { transform: translateY(-10px) rotate(-10deg) scale(1.05); }
        }
        
        @keyframes capybaraThrowAnim {
            0% { transform: translateY(-10px) rotate(-15deg); }
            40% { transform: translateY(-5px) rotate(20deg); }
            100% { transform: translateY(-10px) rotate(0deg); }
        }
        
        @keyframes capybaraCelebrate {
            0%, 100% { transform: translateY(-10px) rotate(-5deg) scale(1); }
            25% { transform: translateY(-30px) rotate(5deg) scale(1.1); }
            50% { transform: translateY(-15px) rotate(-3deg) scale(1.05); }
            75% { transform: translateY(-35px) rotate(3deg) scale(1.1); }
        }
        
        /* Sparkle effects around capybara */
        .capybara-sparkle {
            position: absolute;
            font-size: 20px;
            opacity: 0;
            z-index: 55;
            pointer-events: none;
        }
        
        .capybara-sparkle.active {
            animation: sparkleAnim 1s ease-out forwards;
        }
        
        @keyframes sparkleAnim {
            0% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(360deg) translateY(-30px); }
        }
        
        /* Capybara arm/hand for pointing */
        .tut-hand {
            position: absolute;
            font-size: 35px;
            z-index: 60;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.3));
        }
        
        /* Cursor pointer */
        .tut-cursor {
            position: absolute;
            font-size: 40px;
            z-index: 100;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5));
            transition: all 0.5s ease;
        }
        
        /* Power bar */
        .tut-powerbar {
            position: absolute;
            bottom: 200px;
            left: 12%;
            width: 80px;
            height: 18px;
            background: rgba(0,0,0,0.7);
            border: 3px solid #FFD700;
            border-radius: 10px;
            overflow: hidden;
            z-index: 70;
            opacity: 0;
        }
        
        .tut-powerbar .fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #32CD32, #FFD700, #e63946);
            border-radius: 8px;
            transition: width 0.1s;
        }
        
        /* Flying dart */
        .tut-dart {
            position: absolute;
            font-size: 35px;
            z-index: 80;
            opacity: 0;
            transform: rotate(45deg);
        }
        
        /* Pop effect */
        .tut-pop {
            position: absolute;
            font-size: 50px;
            z-index: 90;
            opacity: 0;
            transform: scale(0);
        }
        
        /* Score popup */
        .tut-score-popup {
            position: absolute;
            font-family: 'Bangers', cursive;
            font-size: 32px;
            color: #FFD700;
            text-shadow: 3px 3px 0 #e63946, -1px -1px 0 #000;
            z-index: 95;
            opacity: 0;
        }
        
        /* Speech bubble */
        .tut-bubble {
            position: absolute;
            background: #fff;
            border-radius: 20px;
            padding: 12px 18px;
            font-family: 'Fredoka One', cursive;
            font-size: 16px;
            color: #333;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 110;
            opacity: 0;
            transform: scale(0);
            max-width: 180px;
            text-align: center;
        }
        
        .tut-bubble::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 25px;
            border: 12px solid transparent;
            border-top-color: #fff;
        }
        
        /* Step indicator */
        .tut-step-indicator {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 120;
        }
        
        .step-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            border: 2px solid #fff;
            transition: all 0.3s;
        }
        
        .step-dot.active {
            background: #FFD700;
            transform: scale(1.3);
            box-shadow: 0 0 10px #FFD700;
        }
        
        .step-dot.completed {
            background: #32CD32;
        }
        
        /* Progress bar */
        .tut-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 6px;
            background: #FFD700;
            z-index: 120;
            transition: width 0.3s;
        }
        
        /* Replay button */
        .tut-replay {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.5);
            color: #fff;
            border: 2px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 120;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .tut-replay:hover {
            background: #FFD700;
            color: #333;
            transform: rotate(360deg);
        }
        
        /* Animation keyframes for tutorial sequence */
        @keyframes capybaraIdle {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(2deg); }
        }
        
        @keyframes capybaraPoint {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        
        @keyframes capybaraThrow {
            0% { transform: rotate(0deg) translateX(0); }
            30% { transform: rotate(-25deg) translateX(-10px); }
            60% { transform: rotate(20deg) translateX(10px); }
            100% { transform: rotate(0deg) translateX(0); }
        }
        
        @keyframes capybaraCelebrate {
            0%, 100% { transform: translateY(0) scale(1); }
            25% { transform: translateY(-20px) scale(1.1); }
            50% { transform: translateY(-10px) scale(1.05); }
            75% { transform: translateY(-25px) scale(1.1); }
        }
        
        @keyframes balloonPop {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        @keyframes scoreFloat {
            0% { opacity: 0; transform: translateY(0) scale(0.5); }
            20% { opacity: 1; transform: translateY(-10px) scale(1.2); }
            100% { opacity: 0; transform: translateY(-60px) scale(1); }
        }
        
        @keyframes popExpand {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        @keyframes bubbleAppear {
            0% { opacity: 0; transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Confetti */
        .tut-confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            z-index: 100;
            opacity: 0;
            font-size: 25px;
        }
        
        @keyframes confettiFall {
            0% { 
                opacity: 1; 
                transform: translateY(0) rotate(0deg) scale(1); 
            }
            100% { 
                opacity: 0; 
                transform: translateY(150px) rotate(720deg) scale(0.5); 
            }
        }
        
        /* Scene Background Elements */
        .scene-stars {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
        }
        
        .scene-star {
            position: absolute;
            color: #fff;
            font-size: 8px;
            animation: twinkle 2s ease-in-out infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }
        
        .scene-lanterns {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
        }
        
        .scene-lantern {
            font-size: 25px;
            animation: lanternSwing 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px currentColor);
        }
        
        @keyframes lanternSwing {
            0%, 100% { transform: rotate(-8deg); }
            50% { transform: rotate(8deg); }
        }
        
        .scene-ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(0deg, #4a3a5a 0%, #3a2a4a 100%);
        }
        
        .scene-booth {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 120px;
            background: linear-gradient(180deg, #8B4513 0%, #654321 100%);
            border-radius: 10px 10px 0 0;
        }
        
        .scene-booth::before {
            content: '';
            position: absolute;
            top: -25px;
            left: -20px;
            right: -20px;
            height: 35px;
            background: repeating-linear-gradient(90deg, #e63946, #e63946 20px, #f1faee 20px, #f1faee 40px);
            border-radius: 10px 10px 0 0;
        }
        
        /* Tutorial Characters */
        .tut-character {
            position: absolute;
            font-size: 70px;
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.5));
            z-index: 10;
        }
        
        .tut-character.main {
            bottom: 60px;
            left: 15%;
            animation: characterBounce 1s ease-in-out infinite;
        }
        
        @keyframes characterBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .tut-character.teacher {
            bottom: 60px;
            right: 10%;
            animation: teacherWave 1.5s ease-in-out infinite;
        }
        
        @keyframes teacherWave {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        /* Speech Bubble */
        .tut-speech {
            position: absolute;
            top: 50px;
            right: 15%;
            background: #fff;
            border-radius: 20px;
            padding: 12px 18px;
            max-width: 200px;
            font-family: 'Fredoka One', cursive;
            font-size: 14px;
            color: #333;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            animation: speechPop 0.5s ease;
        }
        
        .tut-speech::after {
            content: '';
            position: absolute;
            bottom: -15px;
            right: 30px;
            border: 15px solid transparent;
            border-top-color: #fff;
        }
        
        @keyframes speechPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Animated Tutorial Elements */
        .tut-item {
            position: absolute;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5));
        }
        
        .tut-item.cursor {
            font-size: 30px;
            animation: cursorMove 2s ease-in-out infinite;
        }
        
        @keyframes cursorMove {
            0%, 100% { left: 20%; top: 60%; }
            50% { left: 45%; top: 45%; }
        }
        
        .tut-item.power-bar {
            bottom: 70px;
            left: 18%;
            width: 60px;
            height: 15px;
            background: rgba(0,0,0,0.7);
            border: 2px solid #FFD700;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .tut-item.power-bar .fill {
            height: 100%;
            background: linear-gradient(90deg, #32CD32, #FFD700, #e63946);
            animation: powerCharge 2s ease-in-out infinite;
        }
        
        @keyframes powerCharge {
            0%, 100% { width: 20%; }
            50% { width: 90%; }
        }
        
        .tut-item.dart-fly {
            font-size: 25px;
            animation: dartTravel 2s ease-in-out infinite;
        }
        
        @keyframes dartTravel {
            0% { left: 25%; top: 65%; opacity: 0; transform: rotate(45deg); }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { left: 48%; top: 40%; opacity: 0; transform: rotate(45deg); }
        }
        
        .tut-item.balloon-pop {
            font-size: 25px;
            animation: balloonBurst 2s ease-in-out infinite;
        }
        
        @keyframes balloonBurst {
            0%, 70% { transform: scale(1); opacity: 1; }
            80% { transform: scale(1.5); opacity: 0.5; }
            90%, 100% { transform: scale(0); opacity: 0; }
        }
        
        .tut-item.score-pop {
            font-family: 'Bangers', cursive;
            font-size: 20px;
            color: #FFD700;
            text-shadow: 2px 2px 0 #000;
            animation: scoreFly 2s ease-out infinite;
        }
        
        @keyframes scoreFly {
            0%, 70% { opacity: 0; transform: translateY(0); }
            75% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-30px); }
        }
        
        /* Tutorial Steps Panel */
        .tutorial-panel {
            padding: 25px;
        }
        
        .tutorial-title {
            font-family: 'Bangers', cursive;
            font-size: 36px;
            color: #FFD700;
            text-align: center;
            text-shadow: 3px 3px 0 #e63946;
            margin-bottom: 20px;
        }
        
        .tutorial-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .step-card {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            border-left: 5px solid #4ECDC4;
            transition: transform 0.3s, background 0.3s;
        }
        
        .step-card:hover {
            transform: translateX(10px);
            background: rgba(255,255,255,0.15);
        }
        
        .step-number {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bangers', cursive;
            font-size: 24px;
            color: #333;
            flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .step-icon {
            font-size: 35px;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-family: 'Bangers', cursive;
            font-size: 18px;
            color: #FFD700;
            margin-bottom: 3px;
        }
        
        .step-desc {
            font-family: 'Fredoka One', cursive;
            font-size: 12px;
            color: #fff;
            line-height: 1.4;
        }
        
        /* Pro Tips */
        .tutorial-tips {
            background: linear-gradient(135deg, rgba(78,205,196,0.2), rgba(68,179,171,0.2));
            border: 3px solid #4ECDC4;
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .tips-title {
            font-family: 'Bangers', cursive;
            font-size: 20px;
            color: #4ECDC4;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .tip-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Fredoka One', cursive;
            font-size: 11px;
            color: #fff;
            margin: 8px 0;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .tip-icon {
            font-size: 20px;
        }
        
        /* Start Button */
        .tutorial-start {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Bangers', cursive;
            font-size: 28px;
            border: none;
            border-radius: 15px;
            background: linear-gradient(135deg, #e63946, #FF1493);
            color: #FFFF00;
            cursor: pointer;
            box-shadow: 0 5px 0 #8B0000;
            transition: transform 0.2s;
        }
        
        .tutorial-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #8B0000;
        }
        
        .tutorial-start:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #8B0000;
        }
        
        .mode-icon { font-size: 35px; text-align: center; margin-bottom: 5px; }
        .mode-title { font-family: 'Bangers', cursive; font-size: 22px; color: #FFD700; text-align: center; text-shadow: 2px 2px 0 #000; }
        .mode-subtitle { font-family: 'Fredoka One', cursive; font-size: 11px; color: #4ECDC4; text-align: center; margin-bottom: 8px; }
        
        .mode-features { font-family: 'Fredoka One', cursive; font-size: 10px; color: #fff; margin-bottom: 10px; }
        .mode-features li { margin: 3px 0; list-style: none; }
        .mode-features li::before { content: 'âœ“ '; color: #4ECDC4; }
        
        .mode-price { display: flex; justify-content: center; align-items: center; gap: 5px; background: linear-gradient(135deg, #FFD700, #FFA500); padding: 6px 12px; border-radius: 20px; margin-top: 8px; }
        .mode-price .coin { font-size: 16px; }
        .mode-price .amount { font-family: 'Bangers', cursive; font-size: 18px; color: #8B4513; }
        .mode-price.free { background: linear-gradient(135deg, #32CD32, #228B22); }
        .mode-price.free .amount { color: #fff; }
        
        .mode-badge { position: absolute; top: -5px; right: -5px; background: #e63946; color: #fff; font-family: 'Bangers', cursive; font-size: 10px; padding: 3px 8px; border-radius: 10px; transform: rotate(15deg); }
        
        /* Tutorial Button on Mode Cards */
        .tutorial-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #4ECDC4, #44b3ab);
            border: 2px solid #fff;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 10;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }
        
        .tutorial-btn:hover {
            transform: scale(1.2);
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        
        /* Prize Meter on Menu */
        .menu-prize-meter { background: linear-gradient(180deg, #2a2a5a 0%, #1a1a3a 100%); border: 4px solid #FFD700; border-radius: 15px; padding: 15px; margin-bottom: 15px; z-index: 10; min-width: 320px; }
        .prize-meter-title { font-family: 'Bangers', cursive; font-size: 22px; color: #FFD700; text-align: center; margin-bottom: 10px; text-shadow: 2px 2px 0 #000; }
        .prize-tier { display: flex; align-items: center; gap: 10px; padding: 8px; margin: 5px 0; border-radius: 10px; background: rgba(255,255,255,0.1); }
        .prize-tier-icon { font-size: 28px; }
        .prize-tier-info { flex: 1; }
        .prize-tier-name { font-family: 'Bangers', cursive; font-size: 16px; color: #FFD700; }
        .prize-tier-points { font-family: 'Fredoka One', cursive; font-size: 11px; color: #4ECDC4; }
        .prize-tier-reward { font-family: 'Fredoka One', cursive; font-size: 10px; color: #fff; }
        .prize-tier.grand { background: linear-gradient(90deg, rgba(255,215,0,0.3), rgba(255,165,0,0.3)); border: 2px solid #FFD700; }
        
        .start-button { padding: 15px 50px; font-family: 'Bangers', cursive; font-size: 40px; border: 5px solid #8B4513; border-radius: 18px; background: linear-gradient(135deg, #e63946, #FF1493); color: #FFFF00; cursor: pointer; box-shadow: 0 6px 0 #8B0000; z-index: 10; animation: pulse 1.5s ease-in-out infinite; margin-bottom: 20px; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        
        .watermark { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); font-family: 'Fredoka One', cursive; font-size: 12px; color: rgba(255,255,255,0.25); z-index: 1000; }
        
        /* Game Screen */
        .game-screen { display: none; visibility: hidden; width: 100%; height: 100vh; position: relative; }
        .game-screen.active { display: block; visibility: visible; }
        
        /* Top Bar with Clouds - Used for all game modes */
        .game-top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(180deg, #1a0a2e 0%, #2d1b4e 100%);
            z-index: 90;
            overflow: hidden;
            display: none;
        }
        
        .game-cloud {
            position: absolute;
            font-size: 40px;
            opacity: 0.6;
            animation: cloudDrift 20s linear infinite;
            filter: blur(1px);
        }
        
        .game-cloud.cloud-1 { top: 10px; left: -60px; animation-duration: 25s; }
        .game-cloud.cloud-2 { top: 30px; left: -60px; animation-duration: 30s; animation-delay: -10s; font-size: 30px; }
        .game-cloud.cloud-3 { top: 5px; left: -60px; animation-duration: 22s; animation-delay: -5s; font-size: 50px; }
        .game-cloud.cloud-4 { top: 20px; left: -60px; animation-duration: 28s; animation-delay: -15s; font-size: 35px; }
        
        @keyframes cloudDrift {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 120px)); }
        }
        
        .game-confetti {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle, #FF6B6B 2px, transparent 2px),
                radial-gradient(circle, #4ECDC4 2px, transparent 2px),
                radial-gradient(circle, #FFD700 2px, transparent 2px),
                radial-gradient(circle, #FF69B4 2px, transparent 2px);
            background-size: 80px 80px, 60px 60px, 70px 70px, 90px 90px;
            background-position: 0 0, 30px 30px, 15px 45px, 45px 15px;
            opacity: 0.5;
            animation: confettiFloat 3s ease-in-out infinite;
        }
        
        @keyframes confettiFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* VS Mode HUD */
        .vs-hud-new {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 100;
        }
        
        .vs-player-panel {
            position: absolute;
            top: 90px;
            padding: 15px;
            pointer-events: auto;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 20px;
            border: 4px solid #FFD700;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
            min-width: 160px;
        }
        
        .p1-panel {
            left: 15px;
            border-color: #FF4444;
            box-shadow: 0 5px 25px rgba(255,68,68,0.4), inset 0 0 20px rgba(255,68,68,0.1);
        }
        
        .p2-panel {
            right: 15px;
            border-color: #4444FF;
            box-shadow: 0 5px 25px rgba(68,68,255,0.4), inset 0 0 20px rgba(68,68,255,0.1);
        }
        
        .vs-player-title {
            font-family: 'Bangers', cursive;
            font-size: 24px;
            text-align: center;
            margin-bottom: 5px;
            text-shadow: 2px 2px 0 #000;
        }
        
        .p1-panel .vs-player-title { color: #FF4444; }
        .p2-panel .vs-player-title { color: #4444FF; }
        
        .vs-control-hint {
            font-family: 'Fredoka One', cursive;
            font-size: 10px;
            color: #4ECDC4;
            text-align: center;
            margin-bottom: 8px;
            background: rgba(78,205,196,0.2);
            padding: 4px 8px;
            border-radius: 10px;
            border: 1px solid #4ECDC4;
        }
        
        .vs-power-container {
            width: 100%;
            margin-bottom: 8px;
            position: relative;
        }
        
        .vs-power-bar-new {
            width: 100%;
            height: 22px;
            background: rgba(50,50,50,0.8);
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid #FFD700;
            box-shadow: inset 0 3px 10px rgba(0,0,0,0.5);
        }
        
        .vs-power-fill-new {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #32CD32, #FFD700, #FF6B6B, #e63946);
            transition: width 0.03s linear;
            border-radius: 8px;
            box-shadow: 0 0 15px currentColor;
        }
        
        .vs-power-percent {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Bangers', cursive;
            font-size: 12px;
            color: #fff;
            text-shadow: 1px 1px 2px #000;
            pointer-events: none;
        }
        
        .vs-score-label {
            font-family: 'Bangers', cursive;
            font-size: 20px;
            color: #FFD700;
            text-align: center;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 10px;
        }
        
        .vs-score-label span {
            font-size: 24px;
        }
        
        /* Dart Box Display */
        .vs-dart-box {
            background: linear-gradient(135deg, #8B4513 0%, #654321 100%);
            border: 3px solid #D2691E;
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            box-shadow: inset 0 3px 10px rgba(0,0,0,0.4);
        }
        
        .vs-dart-box-label {
            font-family: 'Bangers', cursive;
            font-size: 12px;
            color: #FFD700;
            margin-bottom: 8px;
            text-shadow: 1px 1px 0 #000;
        }
        
        .vs-dart-preview {
            width: 60px;
            height: auto;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
            animation: dartBounce 1.5s ease-in-out infinite;
        }
        
        .p1-dart-img {
            transform: rotate(-90deg);
        }
        
        .p2-dart-img {
            transform: rotate(-90deg);
        }
        
        @keyframes dartBounce {
            0%, 100% { transform: rotate(-90deg) translateX(0); }
            50% { transform: rotate(-90deg) translateX(-5px); }
        }
        
        /* VS Dart Projectile going UP */
        .vs-dart-projectile {
            position: fixed;
            width: 70px;
            height: auto;
            z-index: 200;
            pointer-events: none;
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.6));
        }
        
        .vs-dart-projectile.p1 {
            transform: rotate(-90deg);
        }
        
        .vs-dart-projectile.p2 {
            transform: rotate(-90deg);
        }
        
        /* VS Mode Cannons */
        .vs-cannons {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 280px;
            pointer-events: none;
            z-index: 150;
        }
        
        .vs-cannon {
            position: absolute;
            bottom: 10px;
            width: 280px;
            height: 220px;
        }
        
        .p1-cannon {
            left: 30px;
            /* Cannon faces right toward center (original orientation) */
        }
        
        .p2-cannon {
            right: 30px;
            transform: scaleX(-1); /* Flip to face left toward center */
        }
        
        .cannon-img {
            width: 280px;
            height: auto;
            filter: drop-shadow(4px 4px 10px rgba(0,0,0,0.7));
        }
        
        .cannon-dart {
            position: absolute;
            top: -30px;
            left: 75%;
            transform: translateX(-50%);
            width: 70px;
            height: 90px;
            opacity: 1;
            transition: opacity 0.2s;
        }
        
        /* P1 dart points diagonally toward center (up-right) */
        .p1-cannon .cannon-dart {
            transform: translateX(-50%);
        }
        
        .p1-cannon .cannon-dart img {
            width: 70px;
            height: auto;
            transform: rotate(45deg); /* Point up-right toward center */
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.5));
        }
        
        /* P2 dart points diagonally toward center (up-left) - cannon is flipped */
        .p2-cannon .cannon-dart {
            transform: translateX(-50%) scaleX(-1); /* Counteract cannon flip */
            left: 75%;
        }
        
        .p2-cannon .cannon-dart img {
            width: 70px;
            height: auto;
            transform: rotate(-45deg); /* Point up-left toward center */
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.5));
        }
        
        .cannon-dart.hidden {
            opacity: 0;
        }
        
        .cannon-dart.reloading {
            animation: reloadDart 0.3s ease-out;
        }
        
        @keyframes reloadDart {
            0% { transform: translateX(-50%) translateY(30px); opacity: 0; }
            100% { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        /* Splash Effect */
        .balloon-splash {
            position: fixed;
            pointer-events: none;
            z-index: 300;
        }
        
        .splash-particle {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            animation: splashParticle 0.5s ease-out forwards;
        }
        
        @keyframes splashParticle {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }
        
        /* VS Flying Balloon Area - CENTER ONLY */
        .vs-balloon-area {
            position: absolute;
            top: 80px;
            left: 200px;
            right: 200px;
            bottom: 60px;
            overflow: hidden;
            z-index: 50;
            pointer-events: none;
        }
        
        .vs-flying-balloon {
            position: fixed;
            width: 70px;
            height: 90px;
            cursor: default;
            transition: transform 0.1s;
            z-index: 51;
            pointer-events: auto;
        }
        
        .vs-flying-balloon:hover {
            transform: scale(1.1);
        }
        
        .vs-balloon-body {
            width: 70px;
            height: 80px;
            border-radius: 50% 50% 50% 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bangers', cursive;
            font-size: 28px;
            font-weight: bold;
            color: #333;
            position: relative;
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.15), 
                        inset 10px 10px 20px rgba(255,255,255,0.4),
                        0 5px 15px rgba(0,0,0,0.3);
        }
        
        .vs-balloon-body::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 20%;
            width: 15px;
            height: 15px;
            background: radial-gradient(ellipse at 30% 30%, rgba(255,255,255,0.9), transparent 70%);
            border-radius: 50%;
        }
        
        .vs-balloon-body.yellow {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        
        .vs-balloon-body.green {
            background: linear-gradient(135deg, #32CD32, #228B22);
        }
        
        .vs-balloon-body.bomb {
            background: linear-gradient(135deg, #1a1a1a, #444);
            font-size: 32px;
        }
        
        .vs-balloon-body.light-blue {
            background: linear-gradient(135deg, #87CEEB, #4ECDC4);
        }
        
        .vs-balloon-knot {
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 15px solid;
            margin: 0 auto;
        }
        
        .vs-balloon-body.yellow + .vs-balloon-knot { border-top-color: #FFA500; }
        .vs-balloon-body.green + .vs-balloon-knot { border-top-color: #228B22; }
        .vs-balloon-body.bomb + .vs-balloon-knot { border-top-color: #333; }
        .vs-balloon-body.light-blue + .vs-balloon-knot { border-top-color: #4ECDC4; }
        
        .vs-flying-balloon.popped {
            animation: vsBalloonPop 0.3s ease-out forwards;
        }
        
        @keyframes vsBalloonPop {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.5; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        /* VS Timer at top center */
        .vs-timer {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Bangers', cursive;
            font-size: 36px;
            color: #FFD700;
            text-shadow: 3px 3px 0 #000;
            z-index: 150;
        }
        
        .legend-icon-bottom.normal-yellow { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .legend-icon-bottom.special-green { background: linear-gradient(135deg, #32CD32, #228B22); }
        
        /* HUD */
        .game-hud { position: absolute; top: 85px; left: 0; right: 0; display: flex; justify-content: space-between; padding: 0 90px; z-index: 100; pointer-events: none; }
        .hud-left, .hud-right { display: flex; flex-direction: column; gap: 8px; }
        .hud-item { font-family: 'Bangers', cursive; font-size: 20px; color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); background: rgba(0,0,0,0.7); padding: 6px 12px; border-radius: 8px; border: 2px solid #FFD700; }
        .hud-item.combo { background: linear-gradient(135deg, #e63946, #FF1493); border-color: #FFD700; animation: comboPulse 0.3s ease; }
        @keyframes comboPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        .combo-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'Bangers', cursive; font-size: 70px; color: #FFD700; text-shadow: 4px 4px 0 #e63946, 8px 8px 0 #000; opacity: 0; z-index: 200; pointer-events: none; }
        .combo-display.show { animation: comboShow 0.8s ease-out forwards; }
        @keyframes comboShow { 0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); } 20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5) translateY(-50px); } }
        
        .power-meter { position: absolute; bottom: 110px; left: 50%; transform: translateX(-50%); width: 180px; height: 22px; background: rgba(0,0,0,0.7); border: 3px solid #FFD700; border-radius: 12px; overflow: hidden; z-index: 100; }
        .power-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #32CD32, #FFD700, #e63946); transition: width 0.05s linear; border-radius: 10px; }
        .power-label { position: absolute; bottom: 136px; left: 50%; transform: translateX(-50%); font-family: 'Bangers', cursive; font-size: 14px; color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); }
        
        .crosshair { position: absolute; width: 36px; height: 36px; pointer-events: none; z-index: 300; transform: translate(-50%, -50%); }
        .crosshair::before, .crosshair::after { content: ''; position: absolute; background: #FFD700; box-shadow: 0 0 8px #FFD700; }
        .crosshair::before { width: 2px; height: 100%; left: 50%; transform: translateX(-50%); }
        .crosshair::after { width: 100%; height: 2px; top: 50%; transform: translateY(-50%); }
        .crosshair-circle { position: absolute; width: 26px; height: 26px; border: 2px solid #FFD700; border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 8px rgba(255, 215, 0, 0.5); }
        
        .dartboard-area { position: absolute; left: 50%; top: 45%; transform: translate(-50%, -50%); width: 480px; height: 480px; display: none; }
        .game-screen.active .dartboard-area { display: block; }
        .rotating-board { width: 480px; height: 480px; position: relative; animation: rotateBoard 12s linear infinite; display: none; }
        .game-screen.active .rotating-board { display: block; }
        .rotating-board.vs-mode { animation: none !important; }
        @keyframes rotateBoard { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .dartboard-center { position: absolute; left: 0; top: 0; width: 480px; height: 480px; border-radius: 50%; background: radial-gradient(circle, #4169E1 0%, #4169E1 12%, #F5F5DC 12%, #F5F5DC 55%, #2E8B57 55%, #2E8B57 100%); border: 12px solid #8B4513; box-shadow: inset 0 0 50px rgba(0,0,0,0.3), 0 12px 50px rgba(0,0,0,0.6), 0 0 0 5px #654321; z-index: 1; display: none; }
        .game-screen.active .dartboard-center { display: block; }
        #balloonContainer { position: absolute; left: 0; top: 0; width: 480px; height: 480px; z-index: 10; }
        
        .balloon { position: absolute; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Bangers', cursive; font-size: 14px; font-weight: bold; color: #000; text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff; cursor: default; transition: transform 0.15s; box-shadow: inset -8px -10px 15px rgba(0,0,0,0.15), inset 8px 8px 15px rgba(255,255,255,0.5), 0 4px 10px rgba(0,0,0,0.3); }
        .balloon::before { content: ''; position: absolute; top: 8%; left: 12%; width: 10px; height: 10px; background: radial-gradient(ellipse at 35% 35%, rgba(255,255,255,0.95), transparent 70%); border-radius: 50%; pointer-events: none; }
        .balloon::after { content: ''; position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 12px solid currentColor; }
        .balloon:hover { transform: scale(1.2); z-index: 20; }
        .balloon.popped { animation: popBalloon 0.3s ease forwards; pointer-events: none; }
        @keyframes popBalloon { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } 100% { transform: scale(0); opacity: 0; } }
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 50% { transform: scale(1.2); } 100% { transform: scale(1); opacity: 1; } }
        
        /* VS Mode specific balloon colors */
        .balloon.red-balloon { background: linear-gradient(135deg, #FF4444, #CC0000); color: #CC0000; }
        .balloon.blue-balloon { background: linear-gradient(135deg, #4444FF, #0000CC); color: #0000CC; }
        
        .balloon-1 { background: linear-gradient(135deg, #FF6B6B, #ee5a5a); color: #ee5a5a; }
        .balloon-2 { background: linear-gradient(135deg, #4ECDC4, #44b3ab); color: #44b3ab; }
        .balloon-3 { background: linear-gradient(135deg, #95E1D3, #7dd3c4); color: #7dd3c4; }
        .balloon-4 { background: linear-gradient(135deg, #F8B500, #e6a800); color: #e6a800; }
        .balloon-5 { background: linear-gradient(135deg, #DDA0DD, #cc8fcc); color: #cc8fcc; }
        .balloon-6 { background: linear-gradient(135deg, #87CEEB, #6fb9d9); color: #6fb9d9; }
        
        .balloon.bomb { background: linear-gradient(135deg, #1a1a1a, #3a3a3a) !important; border: 3px solid #FF0000 !important; color: #FF0000 !important; text-shadow: 0 0 6px #FF0000 !important; animation: bombPulse 0.4s ease-in-out infinite; font-size: 28px !important; }
        @keyframes bombPulse { 0%, 100% { box-shadow: 0 0 10px rgba(255,0,0,0.5); } 50% { box-shadow: 0 0 18px rgba(255,0,0,0.8); } }
        .balloon.gold { background: linear-gradient(135deg, #FFD700, #FFA500) !important; border: 3px solid #FF4444 !important; box-shadow: 0 0 12px rgba(255,215,0,0.8) !important; font-size: 24px !important; }
        .balloon.star { background: linear-gradient(135deg, #FF69B4, #FF1493) !important; border: 3px solid #FFD700 !important; animation: starGlow 0.6s ease-in-out infinite; font-size: 28px !important; }
        @keyframes starGlow { 0%, 100% { box-shadow: 0 0 10px rgba(255,105,180,0.6); } 50% { box-shadow: 0 0 20px rgba(255,105,180,1); } }
        .balloon.freeze { background: linear-gradient(135deg, #00BFFF, #1E90FF) !important; border: 3px solid #fff !important; animation: freezeGlow 0.5s ease-in-out infinite; font-size: 28px !important; }
        @keyframes freezeGlow { 0%, 100% { box-shadow: 0 0 10px rgba(0,191,255,0.6); } 50% { box-shadow: 0 0 18px rgba(0,191,255,1); } }
        .balloon.multiplier { background: linear-gradient(135deg, #9400D3, #8A2BE2) !important; border: 3px solid #FFD700 !important; animation: multGlow 0.5s ease-in-out infinite; font-size: 24px !important; color: #FFD700 !important; }
        @keyframes multGlow { 0%, 100% { box-shadow: 0 0 10px rgba(148,0,211,0.6); } 50% { box-shadow: 0 0 18px rgba(148,0,211,1); } }
        
        .rotating-board.frozen { animation: none !important; }
        .frozen-overlay { position: absolute; top: 0; left: 0; width: 480px; height: 480px; background: radial-gradient(circle, rgba(0,191,255,0.3) 0%, transparent 70%); pointer-events: none; z-index: 50; display: none; border-radius: 50%; }
        .frozen-overlay.active { display: block; animation: frozenPulse 1s ease-in-out infinite; }
        @keyframes frozenPulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 0.8; } }
        
        /* Player frozen indicator */
        .player-frozen-overlay { 
            position: fixed; 
            top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(0, 191, 255, 0.3); 
            z-index: 1000; 
            display: none; 
            pointer-events: none;
        }
        .player-frozen-overlay.active { display: block; animation: frozenPulse 0.5s ease-in-out infinite; }
        .player-frozen-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Bangers', cursive;
            font-size: 48px;
            color: #00BFFF;
            text-shadow: 3px 3px 0 #fff, 6px 6px 0 #000;
        }
        
        .dart-projectile { 
            position: absolute; 
            width: 80px; 
            height: 80px; 
            z-index: 200; 
            pointer-events: none; 
        }
        .dart-projectile img { 
            width: 80px; 
            height: auto; 
            transform-origin: center center;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.5));
        }
        
        .timer-bar { position: absolute; top: 75px; left: 50%; transform: translateX(-50%); width: 280px; height: 18px; background: rgba(0,0,0,0.7); border: 2px solid #FFD700; border-radius: 10px; overflow: hidden; z-index: 100; display: none; }
        .timer-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #e63946, #FFD700, #32CD32); transition: width 0.1s linear; }
        .timer-bar.active { display: block; }
        
        /* Game Legend - positioned below game area */
        .game-legend-bottom {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 10px 20px;
            display: flex;
            gap: 20px;
            z-index: 100;
        }
        .legend-item-bottom {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-size: 12px;
        }
        .legend-icon-bottom {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        .legend-icon-bottom.red { background: linear-gradient(135deg, #FF4444, #CC0000); }
        .legend-icon-bottom.blue { background: linear-gradient(135deg, #4444FF, #0000CC); }
        .legend-icon-bottom.bomb { background: linear-gradient(135deg, #1a1a1a, #3a3a3a); border: 2px solid #FF0000; }
        .legend-icon-bottom.freeze { background: linear-gradient(135deg, #00BFFF, #1E90FF); }
        
        /* Capybara Dart Holder */
        .capybara-dart-holder {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 150;
        }
        
        .capybara-holder-img {
            width: 100px;
            height: auto;
            animation: capybaraHolderBounce 2s ease-in-out infinite;
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.5));
            cursor: pointer;
        }
        
        @keyframes capybaraHolderBounce {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-8px) rotate(2deg); }
        }
        
        .capybara-holder-img.charging {
            animation: capybaraCharging 0.2s ease-in-out infinite;
        }
        
        @keyframes capybaraCharging {
            0%, 100% { transform: scale(1) rotate(-3deg); }
            50% { transform: scale(1.1) rotate(3deg); }
        }
        
        .capybara-holder-img.throwing {
            animation: capybaraThrowing 0.3s ease-out;
        }
        
        @keyframes capybaraThrowing {
            0% { transform: rotate(-15deg); }
            50% { transform: rotate(20deg) translateY(-10px); }
            100% { transform: rotate(0deg); }
        }
            padding: 8px 18px;
            border-radius: 25px;
            border: 3px solid #FFD700;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5), inset 0 2px 10px rgba(255,215,0,0.2);
        }
        
        .single-dart-img {
            width: 40px;
            height: auto;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5));
            animation: dartBob 1.5s ease-in-out infinite;
        }
        
        @keyframes dartBob {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-5px) rotate(5deg); }
        }
        
        .dart-count {
            font-family: 'Bangers', cursive;
            font-size: 28px;
            color: #FFD700;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(255,215,0,0.5);
        }
        
        .dart-holder {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            background: rgba(0,0,0,0.85);
            padding: 12px 20px;
            border-radius: 25px;
            border: 4px solid #FFD700;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6), 0 0 15px rgba(255,215,0,0.3);
        }
        
        .current-dart {
            position: relative;
            transition: all 0.2s ease;
        }
        
        .current-dart img {
            width: 60px;
            height: auto;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
            transform: rotate(-90deg);
            transition: all 0.2s ease;
        }
        
        .current-dart.thrown img {
            opacity: 0;
            transform: rotate(-90deg) translateY(-30px);
        }
        
        .current-dart.reloading img {
            animation: reloadDartClassic 0.3s ease-out;
        }
        
        @keyframes reloadDartClassic {
            0% { opacity: 0; transform: rotate(-90deg) translateY(30px); }
            100% { opacity: 1; transform: rotate(-90deg) translateY(0); }
        }
        
        .dart-count-display {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .dart-count {
            font-family: 'Bangers', cursive;
            font-size: 32px;
            color: #FFD700;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(255,215,0,0.5);
            line-height: 1;
        }
        
        .dart-label {
            font-family: 'Fredoka One', cursive;
            font-size: 12px;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
        }
        
        .dart-icon {
            width: 30px;
            height: 30px;
            background: url('dart.png') center/contain no-repeat;
            position: relative;
            animation: dartIconBob 1s ease-in-out infinite;
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));
        }
        
        @keyframes dartIconBob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        
        /* Fireworks effect */
        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            animation: fireworkExplode 0.8s ease-out forwards;
            pointer-events: none;
            z-index: 300;
        }
        
        @keyframes fireworkExplode {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        /* Splash effect when balloon pops */
        .splash-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 250;
            animation: splashOut 0.5s ease-out forwards;
        }
        
        @keyframes splashOut {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }
        
        /* Power bar improvements */
        .power-meter {
            position: absolute;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 25px;
            background: rgba(0,0,0,0.8);
            border: 3px solid #FFD700;
            border-radius: 15px;
            overflow: hidden;
            z-index: 160;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5), inset 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .power-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #32CD32, #FFD700, #FF6B6B, #e63946);
            transition: width 0.05s linear;
            border-radius: 12px;
            box-shadow: 0 0 10px currentColor;
        }
        
        .power-label {
            position: absolute;
            bottom: 210px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Bangers', cursive;
            font-size: 16px;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            background: rgba(0,0,0,0.6);
            padding: 5px 15px;
            border-radius: 10px;
        }
        
        /* Legend at bottom-left */
        .game-legend {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            border: 3px solid #FFD700;
            border-radius: 20px;
            padding: 10px 25px;
            z-index: 200;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            display: none;
            flex-direction: row;
            gap: 20px;
            align-items: center;
        }
        
        .legend-title {
            font-family: 'Bangers', cursive;
            font-size: 16px;
            color: #FFD700;
            text-shadow: 1px 1px 0 #000;
            margin-right: 5px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'Fredoka One', cursive;
            font-size: 12px;
            color: #fff;
        }
        
        .legend-icon {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .legend-icon.normal { background: linear-gradient(135deg, #FF6B6B, #4ECDC4); }
        .legend-icon.gold { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .legend-icon.star { background: linear-gradient(135deg, #FF69B4, #FF1493); }
        .legend-icon.freeze { background: linear-gradient(135deg, #00BFFF, #1E90FF); }
        .legend-icon.multiplier { background: linear-gradient(135deg, #9400D3, #8A2BE2); color: #FFD700; }
        .legend-icon.bomb { background: linear-gradient(135deg, #1a1a1a, #3a3a3a); border: 2px solid #FF0000; }
        
        /* VS Mode bottom legend */
        .game-legend-bottom {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            border: 3px solid #FFD700;
            border-radius: 20px;
            padding: 10px 25px;
            display: flex;
            gap: 25px;
            z-index: 200;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        
        .charge-instruction {
            font-family: 'Fredoka One', cursive;
            font-size: 12px;
            color: #FFD700;
            text-shadow: 1px 1px 2px #000;
            margin-top: 5px;
            animation: instructPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes instructPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .score-popup { position: absolute; font-family: 'Bangers', cursive; font-size: 28px; color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.9); pointer-events: none; z-index: 300; animation: scoreFloat 0.8s ease-out forwards; }
        .score-popup.negative { color: #FF0000; }
        .score-popup.bonus { color: #FF69B4; font-size: 34px; }
        @keyframes scoreFloat { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -80px) scale(1.2); } }
        
        .explosion { position: absolute; border-radius: 50%; pointer-events: none; z-index: 150; }
        .explosion.normal { width: 60px; height: 60px; background: radial-gradient(circle, #FFD700 0%, #FFA500 40%, transparent 70%); animation: explodeNormal 0.4s ease-out forwards; }
        .explosion.bomb { width: 100px; height: 100px; background: radial-gradient(circle, #FFD700 0%, #FF4500 30%, #FF0000 60%, transparent 70%); animation: explodeBomb 0.5s ease-out forwards; }
        .explosion.star { width: 150px; height: 150px; background: radial-gradient(circle, #FF69B4 0%, #FF1493 40%, transparent 70%); animation: explodeStar 0.6s ease-out forwards; }
        @keyframes explodeNormal { 0% { transform: translate(-50%, -50%) scale(0); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; } }
        @keyframes explodeBomb { 0% { transform: translate(-50%, -50%) scale(0); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2); opacity: 0; } }
        @keyframes explodeStar { 0% { transform: translate(-50%, -50%) scale(0); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; } }
        
        .confetti { position: absolute; width: 8px; height: 8px; animation: confettiFall 2.5s linear forwards; z-index: 400; }
        @keyframes confettiFall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        
        .particle { position: absolute; width: 4px; height: 4px; border-radius: 50%; pointer-events: none; z-index: 300; animation: particleFly 0.5s ease-out forwards; }
        @keyframes particleFly { 0% { opacity: 1; transform: translate(0, 0) scale(1); } 100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0); } }
        
        .shake { animation: screenShake 0.3s ease; }
        @keyframes screenShake { 0%, 100% { transform: translateX(0); } 20% { transform: translateX(-10px); } 40% { transform: translateX(10px); } 60% { transform: translateX(-5px); } 80% { transform: translateX(5px); } }
        
        .game-over-screen { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #FFD700, #FFA500); border: 6px solid #8B4513; border-radius: 20px; padding: 25px; text-align: center; box-shadow: 0 12px 40px rgba(0,0,0,0.7); z-index: 500; min-width: 320px; }
        .game-over-screen.active { display: block; animation: gameOverAppear 0.5s ease; }
        @keyframes gameOverAppear { 0% { transform: translate(-50%, -50%) scale(0); } 100% { transform: translate(-50%, -50%) scale(1); } }
        .game-over-title { font-family: 'Bangers', cursive; font-size: 40px; color: #e63946; text-shadow: 3px 3px 0 #000; margin-bottom: 10px; }
        .final-score { font-family: 'Londrina Solid', cursive; font-size: 28px; color: #8B4513; margin-bottom: 8px; }
        .stats-row { font-family: 'Fredoka One', cursive; font-size: 14px; color: #654321; margin: 4px 0; }
        .prize-won { font-family: 'Fredoka One', cursive; font-size: 18px; color: #FF1493; margin: 12px 0; }
        .replay-button { padding: 10px 28px; font-family: 'Bangers', cursive; font-size: 24px; border: 4px solid #8B4513; border-radius: 10px; background: linear-gradient(135deg, #e63946, #FF1493); color: #FFFF00; cursor: pointer; box-shadow: 0 4px 0 #8B0000; margin: 4px; }
        .replay-button:hover { transform: translateY(-2px); }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer">
        <div class="main-menu" id="mainMenu">
            <!-- Floating Clouds Background -->
            <div class="menu-cloud cloud1"></div>
            <div class="menu-cloud cloud2"></div>
            <div class="menu-cloud cloud3"></div>
            <div class="menu-cloud cloud4"></div>
            <div class="menu-cloud cloud5"></div>
            
            <!-- Flying Hot Air Balloons -->
            <img src="hot-air-balloon.png" alt="" class="menu-hot-air-balloon balloon1">
            <img src="hot-air-balloon.png" alt="" class="menu-hot-air-balloon balloon2">
            <img src="hot-air-balloon.png" alt="" class="menu-hot-air-balloon balloon3">
            
            <div class="carnival-stripe"></div>
            <div class="title-container">
                <div class="title">DART LEGACY</div>
                <div class="subtitle" id="menuSubtitle">Aim. Pop. Win. Celebrate!</div>
                <div class="version-tag">â­ ULTIMATE EDITION â­</div>
            </div>
            
            <!-- Language Selector -->
            <div class="language-selector">
                <button class="lang-btn active" id="langEn" onclick="setLanguage('en')">ðŸ‡ºðŸ‡¸ English</button>
                <button class="lang-btn" id="langZh" onclick="setLanguage('zh')">ðŸ‡¹ðŸ‡¼ ä¸­æ–‡</button>
            </div>
            
            <!-- Mode Cards -->
            <div class="mode-cards-container">
                <div class="mode-card active" data-mode="classic" onclick="selectMode('classic')">
                    <!-- Animated Scene: Bear throwing dart at balloons -->
                    <div class="mode-scene">
                        <div class="scene-ground"></div>
                        <div class="scene-char bear">ðŸ»</div>
                        <div class="scene-item balloon" style="left: 50%; top: 35%;">ðŸŽˆ</div>
                        <div class="scene-item balloon" style="left: 62%; top: 45%; animation-delay: 0.5s;">ðŸŽˆ</div>
                        <div class="scene-item balloon" style="left: 75%; top: 30%; animation-delay: 0.3s;">ðŸŽˆ</div>
                        <div class="scene-item pop" style="right: 15px; top: 25px;">ðŸ’¥</div>
                    </div>
                    <div class="mode-title" id="classicTitle">CLASSIC</div>
                    <div class="mode-subtitle" id="classicSub">The Original Experience</div>
                    <ul class="mode-features">
                        <li id="classicF1">25 Darts</li>
                        <li id="classicF2">72 Balloons</li>
                        <li id="classicF3">All Power-ups</li>
                    </ul>
                    <div class="mode-price">
                        <span class="coin">ðŸ’µ</span>
                        <span class="amount" id="classicPrice">NT$ 25</span>
                    </div>
                    <button class="tutorial-btn" onclick="event.stopPropagation(); showTutorial('classic')">â“</button>
                </div>
                
                <div class="mode-card" data-mode="timeToAttack" onclick="selectMode('timeToAttack')">
                    <!-- Animated Scene: Time + Survival combined -->
                    <div class="mode-scene">
                        <div class="scene-ground"></div>
                        <div class="scene-item heart h1">â¤ï¸</div>
                        <div class="scene-item heart h2">â¤ï¸</div>
                        <div class="scene-item heart h3">â¤ï¸</div>
                        <div class="scene-char mouse">ðŸ¹</div>
                        <div class="scene-item clock">â±ï¸</div>
                        <div class="scene-item bomb b1">ðŸ’£</div>
                        <div class="scene-item bomb b2">ðŸ’£</div>
                        <div class="scene-item speed-lines" style="left: 5%; top: 50%;">â†’â†’â†’</div>
                    </div>
                    <div class="mode-title" id="timeToAttackTitle">TIME TO ATTACK</div>
                    <div class="mode-subtitle" id="timeToAttackSub">60s + 3 Lives + Bombs!</div>
                    <ul class="mode-features">
                        <li id="timeToAttackF1">60 Seconds</li>
                        <li id="timeToAttackF2">3 Lives</li>
                        <li id="timeToAttackF3">Many Bombs!</li>
                    </ul>
                    <div class="mode-price">
                        <span class="coin">ðŸ’µ</span>
                        <span class="amount" id="timeToAttackPrice">NT$ 35</span>
                    </div>
                    <button class="tutorial-btn" onclick="event.stopPropagation(); showTutorial('timeToAttack')">â“</button>
                </div>
                
                <div class="mode-card vs-card" data-mode="versus" onclick="selectMode('versus')">
                    <div class="mode-badge" style="background: #FF1493;">HOT</div>
                    <!-- Animated Scene: Bear vs Rabbit battle -->
                    <div class="mode-scene">
                        <div class="scene-ground"></div>
                        <div class="scene-char bear">ðŸ»</div>
                        <div class="scene-char rabbit">ðŸ°</div>
                        <div class="scene-item vs-text">VS</div>
                        <div class="scene-item lightning l1">âš¡</div>
                        <div class="scene-item lightning l2">âš¡</div>
                        <div class="scene-item fire" style="left: 25%; bottom: 20px;">ðŸ”¥</div>
                        <div class="scene-item fire" style="right: 25%; bottom: 20px; animation-delay: 0.15s;">ðŸ”¥</div>
                    </div>
                    <div class="mode-title" id="vsTitle">VS MODE</div>
                    <div class="mode-subtitle" id="vsSub">Player vs Player</div>
                    <ul class="mode-features">
                        <li id="vsF1">Flying Balloons!</li>
                        <li id="vsF2">P1: SPACE | P2: ENTER</li>
                        <li id="vsF3">Hold to Charge Power</li>
                    </ul>
                    <div class="mode-price">
                        <span class="coin">ðŸ’µ</span>
                        <span class="amount" id="vsPrice">NT$ 50</span>
                    </div>
                    <button class="tutorial-btn" onclick="event.stopPropagation(); showTutorial('versus')">â“</button>
                </div>
            </div>
            
            <!-- Prize Meter -->
            <div class="menu-prize-meter">
                <div class="prize-meter-title" id="prizeTitle">ðŸ† PRIZE TIERS ðŸ†</div>
                <div class="prize-tier grand">
                    <div class="prize-tier-icon">ðŸ‘‘</div>
                    <div class="prize-tier-info">
                        <div class="prize-tier-name" id="prizeName1">GRAND CHAMPION</div>
                        <div class="prize-tier-points" id="prizePoints1">1000+ Points</div>
                        <div class="prize-tier-reward" id="prizeReward1">ðŸŽ Giant Teddy Bear + VIP Pass</div>
                    </div>
                </div>
                <div class="prize-tier">
                    <div class="prize-tier-icon">ðŸ¥‡</div>
                    <div class="prize-tier-info">
                        <div class="prize-tier-name" id="prizeName2">GOLD WINNER</div>
                        <div class="prize-tier-points" id="prizePoints2">500+ Points</div>
                        <div class="prize-tier-reward" id="prizeReward2">ðŸ§¸ Large Stuffed Animal</div>
                    </div>
                </div>
                <div class="prize-tier">
                    <div class="prize-tier-icon">ðŸ¥ˆ</div>
                    <div class="prize-tier-info">
                        <div class="prize-tier-name" id="prizeName3">SILVER STAR</div>
                        <div class="prize-tier-points" id="prizePoints3">250+ Points</div>
                        <div class="prize-tier-reward" id="prizeReward3">ðŸŽª Medium Plush Toy</div>
                    </div>
                </div>
                <div class="prize-tier">
                    <div class="prize-tier-icon">ðŸ¥‰</div>
                    <div class="prize-tier-info">
                        <div class="prize-tier-name" id="prizeName4">BRONZE PLAYER</div>
                        <div class="prize-tier-points" id="prizePoints4">100+ Points</div>
                        <div class="prize-tier-reward" id="prizeReward4">ðŸŽˆ Small Prize + Candy</div>
                    </div>
                </div>
            </div>
            
            <button class="start-button" onclick="startGame()" id="startBtn">PLAY!</button>
        </div>
        
        <!-- Tutorial Modal -->
        <div class="tutorial-modal" id="tutorialModal">
            <div class="tutorial-content">
                <button class="tutorial-close" onclick="closeTutorial()">âœ• CLOSE</button>
                
                <!-- Animated Video Tutorial Scene -->
                <div class="tutorial-scene" id="tutorialScene">
                    <div class="video-tutorial" id="videoTutorial">
                        <!-- Clouds -->
                        <div class="tut-cloud" style="top: 10%; animation-delay: 0s;">â˜ï¸</div>
                        <div class="tut-cloud" style="top: 5%; animation-delay: 5s;">â˜ï¸</div>
                        <div class="tut-cloud" style="top: 15%; animation-delay: 10s;">â˜ï¸</div>
                        
                        <!-- Ground -->
                        <div class="tut-ground"></div>
                        <div class="tut-grass" style="left: 5%;">ðŸŒ¿</div>
                        <div class="tut-grass" style="left: 25%;">ðŸŒ±</div>
                        <div class="tut-grass" style="left: 45%;">ðŸŒ¿</div>
                        <div class="tut-grass" style="left: 65%;">ðŸŒ±</div>
                        <div class="tut-grass" style="left: 85%;">ðŸŒ¿</div>
                        
                        <!-- Carnival Booth -->
                        <div class="tut-booth">
                        </div>
                        
                        <!-- Balloons floating -->
                        <div class="tut-balloon" id="balloon1" style="right: 13%; top: 115px;">ðŸŽˆ</div>
                        <div class="tut-balloon" id="balloon2" style="right: 18%; top: 140px;">ðŸŸ¡</div>
                        <div class="tut-balloon" id="balloon3" style="right: 8%; top: 150px;">ðŸ”µ</div>
                        <div class="tut-balloon" id="balloon4" style="right: 15%; top: 170px;">ðŸŸ¢</div>
                        
                        <!-- Capybara Character with Balloons -->
                        <img src="capybara-balloon.png" alt="Capybara with Balloons" class="tut-capybara" id="tutCapybara">
                        
                        <!-- Sparkle effects -->
                        <div class="capybara-sparkle" id="sparkle1" style="left: 18%; bottom: 180px;">âœ¨</div>
                        <div class="capybara-sparkle" id="sparkle2" style="left: 8%; bottom: 150px;">â­</div>
                        <div class="capybara-sparkle" id="sparkle3" style="left: 22%; bottom: 200px;">ðŸ’«</div>
                        <div class="capybara-sparkle" id="sparkle4" style="left: 5%; bottom: 170px;">ðŸŒŸ</div>
                        
                        <!-- Hand/Pointer -->
                        <div class="tut-hand" id="tutHand" style="left: 28%; bottom: 180px; opacity: 0;">ðŸ‘†</div>
                        
                        <!-- Cursor -->
                        <div class="tut-cursor" id="tutCursor" style="left: 30%; top: 50%; opacity: 0;">ðŸ‘†</div>
                        
                        <!-- Power Bar -->
                        <div class="tut-powerbar" id="tutPowerbar">
                            <div class="fill" id="tutPowerFill"></div>
                        </div>
                        
                        <!-- Flying Dart -->
                        <div class="tut-dart" id="tutDart"><img src="dart.png" alt="dart" style="width: 30px;"></div>
                        
                        <!-- Pop Effect -->
                        <div class="tut-pop" id="tutPop">ðŸ’¥</div>
                        
                        <!-- Score Popup -->
                        <div class="tut-score-popup" id="tutScorePopup">+15</div>
                        
                        <!-- Speech Bubble -->
                        <div class="tut-bubble" id="tutBubble" style="left: 10%; top: 30px;"></div>
                        
                        <!-- Step Indicator -->
                        <div class="tut-step-indicator" id="stepIndicator">
                            <div class="step-dot" data-step="1"></div>
                            <div class="step-dot" data-step="2"></div>
                            <div class="step-dot" data-step="3"></div>
                            <div class="step-dot" data-step="4"></div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="tut-progress" id="tutProgress" style="width: 0%;"></div>
                        
                        <!-- Replay Button -->
                        <button class="tut-replay" onclick="replayTutorial()" title="Replay">ðŸ”„</button>
                        
                        <!-- Confetti (hidden, shown on celebration) -->
                        <div class="tut-confetti" id="confetti1">ðŸŽ‰</div>
                        <div class="tut-confetti" id="confetti2">ðŸŽŠ</div>
                        <div class="tut-confetti" id="confetti3">â­</div>
                        <div class="tut-confetti" id="confetti4">âœ¨</div>
                    </div>
                </div>
                
                <!-- Tutorial Panel - Simplified -->
                <div class="tutorial-panel">
                    <div class="tutorial-title" id="tutTitle">ðŸŽ¯ WATCH & LEARN ðŸŽ¯</div>
                    
                    <!-- Current Step Display -->
                    <div class="current-step-display" id="currentStepDisplay" style="
                        background: linear-gradient(135deg, rgba(78,205,196,0.3), rgba(255,215,0,0.3));
                        border: 3px solid #FFD700;
                        border-radius: 15px;
                        padding: 20px;
                        text-align: center;
                        margin-bottom: 15px;
                    ">
                        <div id="stepIcon" style="font-size: 50px; margin-bottom: 10px;">ðŸ‘†</div>
                        <div id="stepTitle" style="font-family: 'Bangers', cursive; font-size: 24px; color: #FFD700; text-shadow: 2px 2px 0 #000;">STEP 1: AIM</div>
                        <div id="stepDesc" style="font-family: 'Fredoka One', cursive; font-size: 14px; color: #fff; margin-top: 8px;">Move your cursor to aim at the balloons!</div>
                    </div>
                    
                    <button class="tutorial-start" onclick="closeTutorial(); startGame();" id="tutStartBtn">
                        ðŸŽ® I'M READY! LET'S PLAY! ðŸŽ®
                    </button>
                </div>
            </div>
        </div>
        
        <div class="game-screen" id="gameScreen">
            <!-- Back to Menu Button -->
            <button class="back-to-menu" id="backToMenuBtn" title="Back to Menu" onclick="if(confirm(currentLang==='en'?'Quit game?':'é€€å‡ºéŠæˆ²ï¼Ÿ')){goToMenu();}">â† MENU</button>
            
            <!-- Music Toggle -->
            <button class="music-toggle" id="musicToggle" onclick="toggleMusic()" title="Toggle Music">ðŸŽµ</button>
            
            <!-- Player Frozen Overlay -->
            <div class="player-frozen-overlay" id="p1FrozenOverlay">
                <div class="player-frozen-text" id="p1FrozenText">â„ï¸ FROZEN! â„ï¸</div>
            </div>
            <div class="player-frozen-overlay" id="p2FrozenOverlay">
                <div class="player-frozen-text" id="p2FrozenText">â„ï¸ FROZEN! â„ï¸</div>
            </div>
            
            <div class="carnival-bg"></div>
            <div class="tent-top"></div>
            <div class="string-lights" id="stringLights"></div>
            <div class="prize-display left" id="leftPrizes"></div>
            <div class="prize-display right" id="rightPrizes"></div>
            <div id="bgBalloons"></div>
            <div class="toy-shelf" id="toyShelf"></div>
            
            <div class="timer-bar" id="timerBar"><div class="timer-fill" id="timerFill"></div></div>
            
            <!-- Normal HUD -->
            <div class="game-hud" id="normalHud">
                <div class="hud-left">
                    <div class="hud-item">ðŸŽ¯ <span id="scoreLabelHud">SCORE</span>: <span id="scoreValue">0</span></div>
                    <div class="hud-item">ðŸŽ¯ <span id="dartsLabelHud">DARTS</span>: <span id="dartsValue">25</span></div>
                    <div class="hud-item" id="livesDisplay" style="display:none;">â¤ï¸ <span id="livesLabelHud">LIVES</span>: <span id="livesValue">3</span></div>
                </div>
                <div class="hud-right">
                    <div class="hud-item" id="comboDisplay">ðŸ”¥ COMBO: <span id="comboValue">x1</span></div>
                    <div class="hud-item">â­ <span id="bestLabelHud">BEST</span>: <span id="bestCombo">x1</span></div>
                </div>
            </div>
            
            <!-- VS HUD - New Design -->
            <!-- Game Top Bar with Clouds (used for all modes) -->
            <div class="game-top-bar" id="gameTopBar">
                <div class="game-cloud cloud-1">â˜ï¸</div>
                <div class="game-cloud cloud-2">â˜ï¸</div>
                <div class="game-cloud cloud-3">â˜ï¸</div>
                <div class="game-cloud cloud-4">â˜ï¸</div>
                <div class="game-confetti"></div>
            </div>
            
            <div class="vs-hud-new" id="vsHud" style="display: none;">
                <!-- Player 1 Panel (Left) -->
                <div class="vs-player-panel p1-panel">
                    <div class="vs-player-title">ðŸ”´ Player 1</div>
                    <div class="vs-control-hint">[ HOLD SPACE ]</div>
                    <div class="vs-power-container">
                        <div class="vs-power-bar-new"><div class="vs-power-fill-new" id="p1PowerFill"></div></div>
                        <div class="vs-power-percent" id="p1PowerPercent">0%</div>
                    </div>
                    <div class="vs-score-label">SCORE: <span id="p1Score">0</span></div>
                </div>
                
                <!-- Player 2 Panel (Right) -->
                <div class="vs-player-panel p2-panel">
                    <div class="vs-player-title">ðŸ”µ Player 2</div>
                    <div class="vs-control-hint">[ HOLD ENTER ]</div>
                    <div class="vs-power-container">
                        <div class="vs-power-bar-new"><div class="vs-power-fill-new" id="p2PowerFill"></div></div>
                        <div class="vs-power-percent" id="p2PowerPercent">0%</div>
                    </div>
                    <div class="vs-score-label">SCORE: <span id="p2Score">0</span></div>
                </div>
            </div>
            
            <!-- VS Flying Balloons Area -->
            <div class="vs-balloon-area" id="vsBalloonArea" style="display: none;">
                <!-- Flying balloons will be spawned here -->
            </div>
            
            <!-- VS Mode Cannons -->
            <div class="vs-cannons" id="vsCannons" style="display: none;">
                <!-- Player 1 Cannon (Left) - faces right toward center -->
                <div class="vs-cannon p1-cannon" id="p1Cannon">
                    <img src="cannon.png" alt="P1 Cannon" class="cannon-img">
                    <div class="cannon-dart" id="p1CannonDart">
                        <img src="dart-p1.png" alt="dart">
                    </div>
                </div>
                
                <!-- Player 2 Cannon (Right) - faces left toward center -->
                <div class="vs-cannon p2-cannon" id="p2Cannon">
                    <img src="cannon.png" alt="P2 Cannon" class="cannon-img">
                    <div class="cannon-dart" id="p2CannonDart">
                        <img src="dart-p2.png" alt="dart">
                    </div>
                </div>
            </div>
            
            <div class="combo-display" id="bigCombo">COMBO x5!</div>
            
            <div class="game-legend" id="normalLegend">
                <div class="legend-title" id="legendTitle">BALLOONS</div>
                <div class="legend-item"><div class="legend-icon normal"></div> +5/10/15</div>
                <div class="legend-item"><div class="legend-icon gold">20</div> +20</div>
                <div class="legend-item"><div class="legend-icon star">â­</div> Chain!</div>
                <div class="legend-item"><div class="legend-icon freeze">â„</div> Freeze</div>
                <div class="legend-item"><div class="legend-icon multiplier">2x</div> Multi</div>
                <div class="legend-item"><div class="legend-icon bomb">ðŸ’£</div> -30</div>
            </div>
            
            <div class="dartboard-area" id="dartboardArea">
                <div class="rotating-board" id="rotatingBoard">
                    <div class="dartboard-center"></div>
                    <div id="balloonContainer"></div>
                </div>
                <div class="frozen-overlay" id="frozenOverlay"></div>
            </div>
            
            <!-- VS Mode Legend (shown at bottom) -->
            <div class="game-legend-bottom" id="vsLegend" style="display: none;">
                <div class="legend-item-bottom"><div class="legend-icon-bottom normal-yellow"></div><span>Yellow = Points</span></div>
                <div class="legend-item-bottom"><div class="legend-icon-bottom bomb">ðŸ’£</div><span>Bomb = -30</span></div>
                <div class="legend-item-bottom"><div class="legend-icon-bottom special-green"></div><span>Green = Bonus</span></div>
            </div>
            
            <div class="power-label" id="powerLabel">HOLD SPACE TO CHARGE</div>
            <div class="power-meter"><div class="power-fill" id="powerFill"></div></div>
            
            <!-- Capybara Dart Holder -->
            <div class="capybara-dart-holder" id="capybaraHolder">
                <div class="dart-holder" id="dartHolder">
                    <div class="current-dart" id="currentDart">
                        <img src="dart.png" alt="Dart" class="single-dart-img">
                    </div>
                    <div class="dart-count-display">
                        <span class="dart-count" id="dartCountHud">25</span>
                        <span class="dart-label">DARTS</span>
                    </div>
                </div>
                <img src="capybara-balloon.png" alt="Capybara" class="capybara-holder-img">
                <div class="charge-instruction" id="chargeInstruction">âŒ¨ï¸ HOLD SPACE</div>
            </div>
            
            <div class="game-over-screen" id="gameOverScreen">
                <div class="game-over-title" id="gameOverTitle">GAME OVER!</div>
                <div class="final-score"><span id="finalScoreLabel">SCORE</span>: <span id="finalScore">0</span></div>
                <div class="stats-row">ðŸŽ¯ <span id="statsPoppedLabel">Popped</span>: <span id="statsPopped">0</span></div>
                <div class="stats-row">ðŸ”¥ <span id="statsBestLabel">Best Combo</span>: <span id="statsBestCombo">x1</span></div>
                <div class="stats-row">ðŸ’¥ <span id="statsAccLabel">Accuracy</span>: <span id="statsAccuracy">0%</span></div>
                <div class="prize-won" id="prizeWon">ðŸ† Prize: NONE</div>
                <button class="replay-button" onclick="restartGame()" id="againBtn">ðŸ”„ AGAIN</button>
                <button class="replay-button" onclick="goToMenu()" id="menuBtn">ðŸ  MENU</button>
            </div>
        </div>
        
        <div class="watermark">J.M.O 2025 - Ultimate Edition</div>
    </div>
    
    <script>
        // Translations
        const translations = {
            en: {
                subtitle: 'Aim. Pop. Win. Celebrate!',
                classicTitle: 'CLASSIC', classicSub: 'The Original Experience',
                classicF1: '25 Darts', classicF2: '72 Balloons', classicF3: 'All Power-ups', classicPrice: 'NT$ 25',
                timeToAttackTitle: 'TIME TO ATTACK', timeToAttackSub: '60s + 3 Lives + Bombs!',
                timeToAttackF1: '60 Seconds', timeToAttackF2: '3 Lives', timeToAttackF3: 'Many Bombs!', timeToAttackPrice: 'NT$ 35',
                vsTitle: 'VS MODE', vsSub: 'Player vs Player',
                vsF1: 'Flying Balloons!', vsF2: 'P1: SPACE | P2: ENTER', vsF3: 'Hold to Charge Power', vsPrice: 'NT$ 50',
                prizeTitle: 'ðŸ† PRIZE TIERS ðŸ†',
                prizeName1: 'GRAND CHAMPION', prizePoints1: '1000+ Points', prizeReward1: 'ðŸŽ Giant Teddy Bear + VIP Pass',
                prizeName2: 'GOLD WINNER', prizePoints2: '500+ Points', prizeReward2: 'ðŸ§¸ Large Stuffed Animal',
                prizeName3: 'SILVER STAR', prizePoints3: '250+ Points', prizeReward3: 'ðŸŽª Medium Plush Toy',
                prizeName4: 'BRONZE PLAYER', prizePoints4: '100+ Points', prizeReward4: 'ðŸŽˆ Small Prize + Candy',
                prizeName5: 'PARTICIPANT', prizePoints5: '0+ Points', prizeReward5: 'ðŸ­ Consolation Candy',
                startBtn: 'PLAY!', badgeFree: 'FREE', backToMenu: 'â† MENU',
                scoreLabelHud: 'SCORE', dartsLabelHud: 'DARTS', bestLabelHud: 'BEST',
                powerLabel: 'HOLD SPACE TO CHARGE', legendTitle: 'BALLOONS',
                p1Name: 'PLAYER 1', p2Name: 'PLAYER 2',
                p1Control: 'SPACE to throw', p2Control: 'MOUSE to throw',
                p1Frozen: 'â„ï¸ FROZEN', p2Frozen: 'â„ï¸ FROZEN',
                gameOverTitle: 'GAME OVER!', finalScoreLabel: 'SCORE',
                statsPoppedLabel: 'Popped', statsBestLabel: 'Best Combo', statsAccLabel: 'Accuracy',
                againBtn: 'ðŸ”„ AGAIN', menuBtn: 'ðŸ  MENU',
                p1Wins: 'ðŸŽ‰ PLAYER 1 WINS!', p2Wins: 'ðŸŽ‰ PLAYER 2 WINS!', tie: "ðŸ¤ IT'S A TIE!",
                vsLegendRed: 'P1 RED = Score', vsLegendBlue: 'P2 BLUE = Score',
                vsLegendBomb: 'Bomb = -1 Dart', vsLegendFreeze: 'Freeze = 5s'
            },
            zh: {
                subtitle: 'çž„æº–ã€‚çˆ†ç ´ã€‚ç²å‹ã€‚æ…¶ç¥ï¼',
                classicTitle: 'ç¶“å…¸æ¨¡å¼', classicSub: 'åŽŸå§‹é«”é©—',
                classicF1: '25 é£›é¢', classicF2: '72 æ°£çƒ', classicF3: 'æ‰€æœ‰é“å…·', classicPrice: 'NT$ 25',
                timeToAttackTitle: 'æ¥µé™æŒ‘æˆ°', timeToAttackSub: '60ç§’ + 3æ¢å‘½ + ç‚¸å½ˆï¼',
                timeToAttackF1: '60 ç§’', timeToAttackF2: '3 æ¢å‘½', timeToAttackF3: 'è¶…å¤šç‚¸å½ˆï¼', timeToAttackPrice: 'NT$ 35',
                vsTitle: 'å°æˆ°æ¨¡å¼', vsSub: 'çŽ©å®¶å°çŽ©å®¶',
                vsF1: 'é£›è¡Œæ°£çƒï¼', vsF2: 'P1: ç©ºç™½éµ | P2: Enter', vsF3: 'æŒ‰ä½è“„åŠ›', vsPrice: 'NT$ 50',
                prizeTitle: 'ðŸ† çŽå“ç­‰ç´š ðŸ†',
                prizeName1: 'è¶…ç´šå† è»', prizePoints1: '1000+ åˆ†', prizeReward1: 'ðŸŽ å·¨åž‹æ³°è¿ªç†Š + VIPé€šè¡Œè­‰',
                prizeName2: 'é‡‘ç‰Œå¾—ä¸»', prizePoints2: '500+ åˆ†', prizeReward2: 'ðŸ§¸ å¤§åž‹çµ¨æ¯›çŽ©å…·',
                prizeName3: 'éŠ€æ˜Ÿé¸æ‰‹', prizePoints3: '250+ åˆ†', prizeReward3: 'ðŸŽª ä¸­åž‹çµ¨æ¯›çŽ©å…·',
                prizeName4: 'éŠ…ç‰ŒçŽ©å®¶', prizePoints4: '100+ åˆ†', prizeReward4: 'ðŸŽˆ å°çŽå“ + ç³–æžœ',
                prizeName5: 'åƒèˆ‡çŽ', prizePoints5: '0+ åˆ†', prizeReward5: 'ðŸ­ å®‰æ…°ç³–æžœ',
                startBtn: 'é–‹å§‹ï¼', badgeFree: 'å…è²»', backToMenu: 'â† é¸å–®',
                scoreLabelHud: 'å¾—åˆ†', dartsLabelHud: 'é£›é¢', bestLabelHud: 'æœ€ä½³',
                powerLabel: 'æŒ‰ä½ç©ºç™½éµè“„åŠ›', legendTitle: 'æ°£çƒèªªæ˜Ž',
                p1Name: 'çŽ©å®¶ 1', p2Name: 'çŽ©å®¶ 2',
                p1Control: 'ç©ºç™½éµæŠ•æ“²', p2Control: 'æ»‘é¼ æŠ•æ“²',
                p1Frozen: 'â„ï¸ å†°å‡ä¸­', p2Frozen: 'â„ï¸ å†°å‡ä¸­',
                gameOverTitle: 'éŠæˆ²çµæŸï¼', finalScoreLabel: 'å¾—åˆ†',
                statsPoppedLabel: 'çˆ†ç ´æ•¸', statsBestLabel: 'æœ€ä½³é€£æ“Š', statsAccLabel: 'å‘½ä¸­çŽ‡',
                againBtn: 'ðŸ”„ å†çŽ©', menuBtn: 'ðŸ  é¸å–®',
                p1Wins: 'ðŸŽ‰ çŽ©å®¶1ç²å‹ï¼', p2Wins: 'ðŸŽ‰ çŽ©å®¶2ç²å‹ï¼', tie: 'ðŸ¤ å¹³æ‰‹ï¼',
                vsLegendRed: 'çŽ©å®¶1 ç´…è‰² = å¾—åˆ†', vsLegendBlue: 'çŽ©å®¶2 è—è‰² = å¾—åˆ†',
                vsLegendBomb: 'ç‚¸å½ˆ = -1é£›é¢', vsLegendFreeze: 'å†°å‡ = 5ç§’'
            }
        };
        
        let currentLang = 'en';
        
        // Tutorial Animation Controller
        let tutorialAnimationId = null;
        let currentTutStep = 0;
        
        const tutorialSteps = {
            classic: {
                en: [
                    { icon: 'ðŸ‘†', title: 'STEP 1: AIM', desc: 'Move your cursor to aim at the balloons!' },
                    { icon: 'ðŸ’ª', title: 'STEP 2: CHARGE', desc: 'Hold mouse button to charge power!' },
                    { icon: 'ðŸŽ¯', title: 'STEP 3: THROW', desc: 'Release to throw the dart!' },
                    { icon: 'ðŸŽ‰', title: 'STEP 4: SCORE!', desc: 'Pop balloons and earn points!' }
                ],
                zh: [
                    { icon: 'ðŸ‘†', title: 'ç¬¬1æ­¥ï¼šçž„æº–', desc: 'ç§»å‹•æ¸¸æ¨™çž„æº–æ°£çƒï¼' },
                    { icon: 'ðŸ’ª', title: 'ç¬¬2æ­¥ï¼šè“„åŠ›', desc: 'æŒ‰ä½æ»‘é¼ æŒ‰éˆ•è“„åŠ›ï¼' },
                    { icon: 'ðŸŽ¯', title: 'ç¬¬3æ­¥ï¼šæŠ•æ“²', desc: 'æ”¾é–‹æŒ‰éˆ•æŠ•æ“²é£›é¢ï¼' },
                    { icon: 'ðŸŽ‰', title: 'ç¬¬4æ­¥ï¼šå¾—åˆ†ï¼', desc: 'çˆ†ç ´æ°£çƒç²å¾—åˆ†æ•¸ï¼' }
                ]
            },
            timeToAttack: {
                en: [
                    { icon: 'â±ï¸', title: 'STEP 1: 60 SECONDS', desc: 'Race against the clock!' },
                    { icon: 'â¤ï¸', title: 'STEP 2: 3 LIVES', desc: 'Don\'t hit bombs! You have 3 lives!' },
                    { icon: 'ðŸ’£', title: 'STEP 3: MANY BOMBS!', desc: 'Watch out for all the bombs!' },
                    { icon: 'ðŸ†', title: 'STEP 4: SURVIVE & SCORE!', desc: 'Get high score before time runs out!' }
                ],
                zh: [
                    { icon: 'â±ï¸', title: 'ç¬¬1æ­¥ï¼š60ç§’', desc: 'èˆ‡æ™‚é–“è³½è·‘ï¼' },
                    { icon: 'â¤ï¸', title: 'ç¬¬2æ­¥ï¼š3æ¢å‘½', desc: 'ä¸è¦ç¢°ç‚¸å½ˆï¼ä½ æœ‰3æ¢å‘½ï¼' },
                    { icon: 'ðŸ’£', title: 'ç¬¬3æ­¥ï¼šå¾ˆå¤šç‚¸å½ˆï¼', desc: 'æ³¨æ„æ‰€æœ‰çš„ç‚¸å½ˆï¼' },
                    { icon: 'ðŸ†', title: 'ç¬¬4æ­¥ï¼šç”Ÿå­˜ä¸¦å¾—åˆ†ï¼', desc: 'åœ¨æ™‚é–“çµæŸå‰ç²å¾—é«˜åˆ†ï¼' }
                ]
            },
            versus: {
                en: [
                    { icon: 'ðŸŽˆ', title: 'STEP 1: FLYING BALLOONS', desc: 'Pop the floating balloons!' },
                    { icon: 'âŒ¨ï¸', title: 'STEP 2: PLAYER 1', desc: 'Hold SPACEBAR to charge power!' },
                    { icon: 'âŒ¨ï¸', title: 'STEP 3: PLAYER 2', desc: 'Hold ENTER key to charge!' },
                    { icon: 'ðŸ†', title: 'STEP 4: HIGHEST SCORE WINS!', desc: 'Yellow=Points, Green=Bonus, Bomb=-30' }
                ],
                zh: [
                    { icon: 'ðŸŽˆ', title: 'ç¬¬1æ­¥ï¼šé£›è¡Œæ°£çƒ', desc: 'å°„æ“Šæ¼‚æµ®çš„æ°£çƒï¼' },
                    { icon: 'âŒ¨ï¸', title: 'ç¬¬2æ­¥ï¼šçŽ©å®¶1', desc: 'æŒ‰ä½ç©ºç™½éµè“„åŠ›ï¼' },
                    { icon: 'âŒ¨ï¸', title: 'ç¬¬3æ­¥ï¼šçŽ©å®¶2', desc: 'æŒ‰ä½Enteréµè“„åŠ›ï¼' },
                    { icon: 'ðŸ†', title: 'ç¬¬4æ­¥ï¼šæœ€é«˜åˆ†ç²å‹ï¼', desc: 'é»ƒè‰²=å¾—åˆ†, ç¶ è‰²=çŽå‹µ, ç‚¸å½ˆ=-30' }
                ]
            }
        };
        
        let currentTutorialMode = 'classic';
        
        function showTutorial(mode) {
            currentTutorialMode = mode;
            currentTutStep = 0;
            
            // Select this mode
            selectMode(mode);
            
            // Update title based on mode
            const titles = {
                classic: { en: 'ðŸŽ¯ CLASSIC MODE ðŸŽ¯', zh: 'ðŸŽ¯ ç¶“å…¸æ¨¡å¼ ðŸŽ¯' },
                timeToAttack: { en: 'â±ï¸ðŸ’€ TIME TO ATTACK â±ï¸ðŸ’€', zh: 'â±ï¸ðŸ’€ æ¥µé™æŒ‘æˆ° â±ï¸ðŸ’€' },
                versus: { en: 'âš”ï¸ VS MODE âš”ï¸', zh: 'âš”ï¸ å°æˆ°æ¨¡å¼ âš”ï¸' }
            };
            const tutTitleEl = document.getElementById('tutTitle');
            if (tutTitleEl && titles[mode]) tutTitleEl.textContent = titles[mode][currentLang] || titles.classic[currentLang];
            
            // Update start button
            const startBtns = {
                classic: { en: "ðŸŽ® I'M READY! LET'S PLAY! ðŸŽ®", zh: 'ðŸŽ® æˆ‘æº–å‚™å¥½äº†ï¼é–‹å§‹ï¼ðŸŽ®' },
                timeToAttack: { en: 'â±ï¸ðŸ’€ START THE CHALLENGE! â±ï¸ðŸ’€', zh: 'â±ï¸ðŸ’€ é–‹å§‹æŒ‘æˆ°ï¼â±ï¸ðŸ’€' },
                versus: { en: 'âš”ï¸ START BATTLE! âš”ï¸', zh: 'âš”ï¸ é–‹å§‹å°æˆ°ï¼âš”ï¸' }
            };
            const tutStartBtnEl = document.getElementById('tutStartBtn');
            if (tutStartBtnEl && startBtns[mode]) tutStartBtnEl.textContent = startBtns[mode][currentLang] || startBtns.classic[currentLang];
            
            // Reset animation elements
            resetTutorialElements();
            
            // Show modal
            document.getElementById('tutorialModal').classList.add('active');
            
            // Start animation after a short delay
            setTimeout(() => {
                playTutorialAnimation();
            }, 500);
        }
        
        function resetTutorialElements() {
            // Reset all animation elements to initial state
            const cursor = document.getElementById('tutCursor');
            const powerbar = document.getElementById('tutPowerbar');
            const powerFill = document.getElementById('tutPowerFill');
            const dart = document.getElementById('tutDart');
            const pop = document.getElementById('tutPop');
            const scorePopup = document.getElementById('tutScorePopup');
            const bubble = document.getElementById('tutBubble');
            const capybara = document.getElementById('tutCapybara');
            const balloons = ['balloon1', 'balloon2', 'balloon3', 'balloon4'];
            
            cursor.style.opacity = '0';
            cursor.style.left = '30%';
            cursor.style.top = '50%';
            
            powerbar.style.opacity = '0';
            powerFill.style.width = '0%';
            
            dart.style.opacity = '0';
            dart.style.left = '25%';
            dart.style.top = '55%';
            
            pop.style.opacity = '0';
            pop.style.transform = 'scale(0)';
            
            scorePopup.style.opacity = '0';
            
            bubble.style.opacity = '0';
            bubble.style.transform = 'scale(0)';
            
            // Reset capybara to floating animation
            capybara.className = 'tut-capybara';
            
            // Reset sparkles
            for (let i = 1; i <= 4; i++) {
                const sparkle = document.getElementById('sparkle' + i);
                if (sparkle) sparkle.classList.remove('active');
            }
            
            // Reset balloons
            balloons.forEach(id => {
                const balloon = document.getElementById(id);
                if (balloon) {
                    balloon.style.opacity = '1';
                    balloon.style.transform = 'scale(1)';
                }
            });
            
            // Reset step dots
            document.querySelectorAll('.step-dot').forEach(dot => {
                dot.classList.remove('active', 'completed');
            });
            
            // Reset progress
            document.getElementById('tutProgress').style.width = '0%';
            
            // Clear any existing animation
            if (tutorialAnimationId) {
                clearTimeout(tutorialAnimationId);
            }
        }
        
        function playTutorialAnimation() {
            const steps = tutorialSteps[currentTutorialMode][currentLang];
            
            // Animation sequence
            animateStep1(); // Aim
            
            function animateStep1() {
                currentTutStep = 0;
                updateStepDisplay(steps[0]);
                updateStepIndicator(1);
                document.getElementById('tutProgress').style.width = '25%';
                
                const cursor = document.getElementById('tutCursor');
                const capybara = document.getElementById('tutCapybara');
                const bubble = document.getElementById('tutBubble');
                
                // Show cursor and animate movement
                cursor.style.opacity = '1';
                cursor.style.transition = 'all 1.5s ease-in-out';
                
                // Capybara pointing animation
                capybara.className = 'tut-capybara pointing';
                
                // Move cursor to target
                setTimeout(() => {
                    cursor.style.left = '82%';
                    cursor.style.top = '42%';
                }, 100);
                
                // Show speech bubble
                bubble.textContent = currentLang === 'en' ? 'Aim here! ðŸ‘€' : 'çž„é€™è£¡ï¼ðŸ‘€';
                bubble.style.left = '50%';
                bubble.style.top = '20px';
                setTimeout(() => {
                    bubble.style.opacity = '1';
                    bubble.style.transform = 'scale(1)';
                }, 500);
                
                tutorialAnimationId = setTimeout(animateStep2, 2500);
            }
            
            function animateStep2() {
                currentTutStep = 1;
                updateStepDisplay(steps[1]);
                updateStepIndicator(2);
                document.getElementById('tutProgress').style.width = '50%';
                
                const powerbar = document.getElementById('tutPowerbar');
                const powerFill = document.getElementById('tutPowerFill');
                const capybara = document.getElementById('tutCapybara');
                const bubble = document.getElementById('tutBubble');
                const cursor = document.getElementById('tutCursor');
                
                // Hide bubble
                bubble.style.opacity = '0';
                bubble.style.transform = 'scale(0)';
                
                // Show power bar
                powerbar.style.opacity = '1';
                
                // Cursor shows click
                cursor.textContent = 'ðŸ‘‡';
                
                // Animate power charging
                let power = 0;
                const chargeInterval = setInterval(() => {
                    power += 2;
                    powerFill.style.width = power + '%';
                    if (power >= 80) {
                        clearInterval(chargeInterval);
                    }
                }, 30);
                
                // Capybara charging animation
                capybara.className = 'tut-capybara charging';
                
                // Show charging bubble
                setTimeout(() => {
                    bubble.textContent = currentLang === 'en' ? 'Charging... ðŸ’ª' : 'è“„åŠ›ä¸­... ðŸ’ª';
                    bubble.style.opacity = '1';
                    bubble.style.transform = 'scale(1)';
                }, 300);
                
                tutorialAnimationId = setTimeout(animateStep3, 2500);
            }
            
            function animateStep3() {
                currentTutStep = 2;
                updateStepDisplay(steps[2]);
                updateStepIndicator(3);
                document.getElementById('tutProgress').style.width = '75%';
                
                const dart = document.getElementById('tutDart');
                const cursor = document.getElementById('tutCursor');
                const capybara = document.getElementById('tutCapybara');
                const bubble = document.getElementById('tutBubble');
                const powerbar = document.getElementById('tutPowerbar');
                
                // Hide bubble and power bar
                bubble.style.opacity = '0';
                powerbar.style.opacity = '0';
                
                // Cursor releases
                cursor.textContent = 'ðŸ‘†';
                cursor.style.opacity = '0';
                
                // Capybara throwing animation
                capybara.className = 'tut-capybara throwing';
                
                // Dart flies!
                dart.style.opacity = '1';
                dart.style.left = '25%';
                dart.style.top = '55%';
                dart.style.transition = 'all 0.6s ease-out';
                
                setTimeout(() => {
                    dart.style.left = '83%';
                    dart.style.top = '38%';
                }, 100);
                
                tutorialAnimationId = setTimeout(animateStep4, 1500);
            }
            
            function animateStep4() {
                currentTutStep = 3;
                updateStepDisplay(steps[3]);
                updateStepIndicator(4);
                document.getElementById('tutProgress').style.width = '100%';
                
                const dart = document.getElementById('tutDart');
                const pop = document.getElementById('tutPop');
                const scorePopup = document.getElementById('tutScorePopup');
                const balloon1 = document.getElementById('balloon1');
                const capybara = document.getElementById('tutCapybara');
                const bubble = document.getElementById('tutBubble');
                
                // Hide dart
                dart.style.opacity = '0';
                
                // Pop balloon
                balloon1.style.animation = 'balloonPop 0.4s ease-out forwards';
                
                // Show pop effect
                pop.style.left = '85%';
                pop.style.top = '35%';
                pop.style.opacity = '1';
                pop.style.animation = 'popExpand 0.5s ease-out forwards';
                
                // Show score
                setTimeout(() => {
                    scorePopup.style.left = '85%';
                    scorePopup.style.top = '25%';
                    scorePopup.textContent = '+15';
                    scorePopup.style.animation = 'scoreFloat 1s ease-out forwards';
                }, 200);
                
                // Capybara celebrates
                capybara.className = 'tut-capybara celebrating';
                
                // Show sparkles
                showSparkles();
                
                // Show celebration bubble
                setTimeout(() => {
                    bubble.textContent = currentLang === 'en' ? 'Great shot! ðŸŽ‰' : 'å¥½æ£’ï¼ðŸŽ‰';
                    bubble.style.opacity = '1';
                    bubble.style.transform = 'scale(1)';
                }, 400);
                
                // Show confetti
                showConfetti();
                
                // Loop the animation
                tutorialAnimationId = setTimeout(() => {
                    resetTutorialElements();
                    setTimeout(playTutorialAnimation, 500);
                }, 3500);
            }
        }
        
        function showSparkles() {
            for (let i = 1; i <= 4; i++) {
                setTimeout(() => {
                    const sparkle = document.getElementById('sparkle' + i);
                    if (sparkle) {
                        sparkle.classList.remove('active');
                        void sparkle.offsetWidth; // Trigger reflow
                        sparkle.classList.add('active');
                    }
                }, i * 150);
            }
        }
        
        function updateStepDisplay(step) {
            const iconEl = document.getElementById('stepIcon');
            const titleEl = document.getElementById('stepTitle');
            const descEl = document.getElementById('stepDesc');
            if (iconEl) iconEl.textContent = step.icon;
            if (titleEl) titleEl.textContent = step.title;
            if (descEl) descEl.textContent = step.desc;
            
            // Add animation
            const display = document.getElementById('currentStepDisplay');
            if (display) {
                display.style.animation = 'none';
                display.offsetHeight; // Trigger reflow
                display.style.animation = 'bubbleAppear 0.3s ease-out';
            }
        }
        
        function updateStepIndicator(step) {
            document.querySelectorAll('.step-dot').forEach((dot, index) => {
                dot.classList.remove('active');
                if (index + 1 < step) {
                    dot.classList.add('completed');
                } else if (index + 1 === step) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('completed');
                }
            });
        }
        
        function showConfetti() {
            const confetti = ['confetti1', 'confetti2', 'confetti3', 'confetti4'];
            const colors = ['ðŸŽ‰', 'ðŸŽŠ', 'â­', 'âœ¨', 'ðŸŒŸ', 'ðŸ’«'];
            
            confetti.forEach((id, index) => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = colors[Math.floor(Math.random() * colors.length)];
                    el.style.left = (60 + Math.random() * 30) + '%';
                    el.style.top = '30%';
                    el.style.opacity = '1';
                    el.style.animation = `confettiFall 1.5s ease-out ${index * 0.1}s forwards`;
                }
            });
        }
        
        function replayTutorial() {
            resetTutorialElements();
            setTimeout(playTutorialAnimation, 300);
        }
        
        function closeTutorial() {
            document.getElementById('tutorialModal').classList.remove('active');
            if (tutorialAnimationId) {
                clearTimeout(tutorialAnimationId);
            }
            resetTutorialElements();
        }
        
        function setLanguage(lang) {
            currentLang = lang;
            const langEn = document.getElementById('langEn');
            const langZh = document.getElementById('langZh');
            if (langEn) langEn.classList.toggle('active', lang === 'en');
            if (langZh) langZh.classList.toggle('active', lang === 'zh');
            
            const t = translations[lang];
            Object.keys(t).forEach(key => {
                const el = document.getElementById(key);
                if (el) el.textContent = t[key];
            });
            
            // Update back to menu button
            const backBtn = document.getElementById('backToMenuBtn');
            if (backBtn) backBtn.textContent = t.backToMenu || 'â† MENU';
            
            // Update VS legend
            const vsLegendRed = document.getElementById('vsLegendRed');
            const vsLegendBlue = document.getElementById('vsLegendBlue');
            const vsLegendBomb = document.getElementById('vsLegendBomb');
            const vsLegendFreeze = document.getElementById('vsLegendFreeze');
            if (vsLegendRed) vsLegendRed.textContent = t.vsLegendRed;
            if (vsLegendBlue) vsLegendBlue.textContent = t.vsLegendBlue;
            if (vsLegendBomb) vsLegendBomb.textContent = t.vsLegendBomb;
            if (vsLegendFreeze) vsLegendFreeze.textContent = t.vsLegendFreeze;
        }
        
        // Audio
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;
        function initAudio() { if (!audioCtx) audioCtx = new AudioContext(); }
        function playSound(type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            switch(type) {
                case 'pop': osc.frequency.setValueAtTime(600, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.1); gain.gain.setValueAtTime(0.3, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); osc.start(); osc.stop(audioCtx.currentTime + 0.1); break;
                case 'bomb': osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 0.3); gain.gain.setValueAtTime(0.4, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3); osc.start(); osc.stop(audioCtx.currentTime + 0.3); break;
                case 'combo': osc.frequency.setValueAtTime(400, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.15); gain.gain.setValueAtTime(0.2, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15); osc.start(); osc.stop(audioCtx.currentTime + 0.15); break;
                case 'special': osc.type = 'sine'; osc.frequency.setValueAtTime(523, audioCtx.currentTime); gain.gain.setValueAtTime(0.3, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3); osc.start(); osc.stop(audioCtx.currentTime + 0.3); break;
                case 'throw': osc.type = 'triangle'; osc.frequency.setValueAtTime(200, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.1); gain.gain.setValueAtTime(0.15, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); osc.start(); osc.stop(audioCtx.currentTime + 0.1); break;
            }
        }
        
        // Background Music System
        let musicPlaying = false;
        let musicInterval = null;
        let masterGain = null;
        
        function startBackgroundMusic() {
            if (!audioCtx || musicPlaying) return;
            musicPlaying = true;
            const musicBtn = document.getElementById('musicToggle');
            if (musicBtn) {
                musicBtn.classList.remove('muted');
                musicBtn.textContent = 'ðŸŽµ';
            }
            
            masterGain = audioCtx.createGain();
            masterGain.gain.setValueAtTime(0.12, audioCtx.currentTime);
            masterGain.connect(audioCtx.destination);
            
            const melody = [
                { note: 523, duration: 0.3 }, { note: 587, duration: 0.3 }, { note: 659, duration: 0.3 },
                { note: 698, duration: 0.3 }, { note: 784, duration: 0.6 }, { note: 784, duration: 0.3 },
                { note: 698, duration: 0.3 }, { note: 659, duration: 0.3 }, { note: 587, duration: 0.3 },
                { note: 523, duration: 0.6 }, { note: 659, duration: 0.3 }, { note: 784, duration: 0.3 },
                { note: 880, duration: 0.6 }, { note: 784, duration: 0.3 }, { note: 659, duration: 0.3 },
                { note: 523, duration: 0.6 },
            ];
            
            let noteIndex = 0;
            
            function playNextNote() {
                if (!musicPlaying || !audioCtx) return;
                const note = melody[noteIndex];
                
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(note.note, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.08, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + note.duration * 0.9);
                osc.connect(gain);
                gain.connect(masterGain);
                osc.start();
                osc.stop(audioCtx.currentTime + note.duration);
                
                const bassOsc = audioCtx.createOscillator();
                const bassGain = audioCtx.createGain();
                bassOsc.type = 'triangle';
                bassOsc.frequency.setValueAtTime(note.note / 2, audioCtx.currentTime);
                bassGain.gain.setValueAtTime(0.06, audioCtx.currentTime);
                bassGain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + note.duration * 0.8);
                bassOsc.connect(bassGain);
                bassGain.connect(masterGain);
                bassOsc.start();
                bassOsc.stop(audioCtx.currentTime + note.duration);
                
                noteIndex = (noteIndex + 1) % melody.length;
                musicInterval = setTimeout(playNextNote, note.duration * 1000);
            }
            
            playNextNote();
        }
        
        function toggleMusic() {
            initAudio();
            if (musicPlaying) {
                stopBackgroundMusic();
            } else {
                startBackgroundMusic();
            }
        }
        
        // Game state
        let gameMode = 'classic';
        let score = 0, dartsRemaining = 25, dartsThrown = 0, balloonsPopped = 0;
        let balloons = [], isThrowingDart = false;
        let combo = 0, bestCombo = 0, comboTimer = null, multiplier = 1;
        let isFrozen = false, freezeTimer = null;
        let gameTimer = null, timeRemaining = 90;
        let isPowerCharging = false, powerLevel = 0, powerInterval = null;
        let mouseX = 0, mouseY = 0, bgBalloonInterval, lives = 3;
        
        // VS Mode
        let currentPlayer = 1, p1Score = 0, p2Score = 0, p1Darts = 15, p2Darts = 15;
        
        function selectMode(mode) {
            gameMode = mode;
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.toggle('active', card.dataset.mode === mode);
            });
        }
        
        function startGame() {
            initAudio();
            startBackgroundMusic();
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameScreen').classList.add('active');
            initializeGame();
        }
        
        function initializeGame() {
            score = 0; dartsThrown = 0; balloonsPopped = 0;
            combo = 0; bestCombo = 0; multiplier = 1;
            isFrozen = false; isPowerCharging = false; powerLevel = 0;
            
            // Hide/show appropriate HUD
            document.getElementById('normalHud').style.display = gameMode === 'versus' ? 'none' : 'flex';
            document.getElementById('vsHud').style.display = gameMode === 'versus' ? 'flex' : 'none';
            
            // Show/hide lives display
            const livesDisplay = document.getElementById('livesDisplay');
            if (livesDisplay) livesDisplay.style.display = (gameMode === 'timeToAttack') ? 'block' : 'none';
            
            const timerBar = document.getElementById('timerBar');
            const livesValueEl = document.getElementById('livesValue');
            
            if (gameMode === 'classic') {
                dartsRemaining = 25;
                lives = 999;
                if (timerBar) timerBar.classList.remove('active');
            } else if (gameMode === 'timeToAttack') {
                dartsRemaining = 999;
                timeRemaining = 60;
                lives = 3;
                if (timerBar) timerBar.classList.add('active');
                if (livesValueEl) livesValueEl.textContent = lives;
                startTimer();
            } else if (gameMode === 'versus') {
                currentPlayer = 1;
                p1Score = 0; p2Score = 0;
                p1Darts = 9999; p2Darts = 9999; // Unlimited
                dartsRemaining = p1Darts;
                lives = 999;
                timeRemaining = 60; // 1 minute match
                p1Frozen = false; p2Frozen = false;
                if (timerBar) timerBar.classList.add('active');
                startVsTimer();
                updateVsHud();
                
                // Hide dartboard, show flying balloon area and cannons
                const dartboardArea = document.getElementById('dartboardArea');
                const vsBalloonArea = document.getElementById('vsBalloonArea');
                const vsCannons = document.getElementById('vsCannons');
                if (dartboardArea) dartboardArea.style.display = 'none';
                if (vsBalloonArea) vsBalloonArea.style.display = 'block';
                if (vsCannons) vsCannons.style.display = 'block';
                
                // Start spawning flying balloons
                startVsFlyingBalloons();
                
                // Add VS mode specific event listeners
                document.addEventListener('keydown', handleVsKeydown);
                document.addEventListener('keyup', handleVsKeyup);
                document.addEventListener('mousedown', handleVsMouseDown);
                document.addEventListener('mouseup', handleVsMouseUp);
            }
            
            // Toggle legend visibility based on mode
            const normalLegend = document.getElementById('normalLegend');
            const vsLegend = document.getElementById('vsLegend');
            const capybaraHolder = document.getElementById('capybaraHolder');
            const normalHud = document.getElementById('normalHud');
            const powerMeter = document.querySelector('.power-meter');
            const powerLabel = document.getElementById('powerLabel');
            
            if (gameMode === 'versus') {
                if (normalLegend) normalLegend.style.display = 'none';
                if (vsLegend) vsLegend.style.display = 'flex';
                if (capybaraHolder) capybaraHolder.style.display = 'none';
                if (normalHud) normalHud.style.display = 'none';
                if (powerMeter) powerMeter.style.display = 'none';
                if (powerLabel) powerLabel.style.display = 'none';
            } else {
                if (normalLegend) normalLegend.style.display = 'flex';
                if (vsLegend) vsLegend.style.display = 'none';
                if (capybaraHolder) capybaraHolder.style.display = 'flex';
                if (normalHud) normalHud.style.display = 'flex';
                if (powerMeter) powerMeter.style.display = 'block';
                if (powerLabel) powerLabel.style.display = 'block';
            }
            
            // Show top bar with clouds for all modes
            const gameTopBar = document.getElementById('gameTopBar');
            if (gameTopBar) gameTopBar.style.display = 'block';
            
            updateHUD();
            createDecorations();
            createBalloons();
            // Enable rotation for ALL modes including VS
            startRotation();
            createFloatingBalloons();
            
            // Only add mouse controls for non-VS modes
            if (gameMode !== 'versus') {
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mousedown', handleMouseDown);
                document.addEventListener('mouseup', handleMouseUp);
                document.addEventListener('keydown', handleKeyDownClassic);
                document.addEventListener('keyup', handleKeyUpClassic);
            }
            // No crosshair for any mode now - power-based throwing
        }
        
        // VS Mode specific variables
        let p1Frozen = false, p2Frozen = false;
        let p1FreezeTimer = null, p2FreezeTimer = null;
        let p1Charging = false, p2Charging = false;
        let p1Power = 0, p2Power = 0;
        let p1ChargeInterval = null, p2ChargeInterval = null;
        let p1Cooldown = false, p2Cooldown = false; // Cooldown to prevent rapid fire
        let vsBalloonSpawnInterval = null;
        let vsFlyingBalloons = [];
        let vsAnimationRunning = false;
        
        function startVsTimer() {
            gameTimer = setInterval(() => {
                timeRemaining--;
                const timerFill = document.getElementById('timerFill');
                if (timerFill) timerFill.style.width = (timeRemaining / 60 * 100) + '%';
                if (timeRemaining <= 0) { 
                    clearInterval(gameTimer); 
                    endVsGame(); 
                }
            }, 1000);
        }
        
        // Flying Balloon System for VS Mode - MANY BALLOONS
        function startVsFlyingBalloons() {
            const area = document.getElementById('vsBalloonArea');
            if (!area) return;
            area.innerHTML = '';
            vsFlyingBalloons = [];
            vsAnimationRunning = true;
            
            // Spawn MANY initial balloons
            for (let i = 0; i < 25; i++) {
                setTimeout(() => spawnVsFlyingBalloon(), i * 100);
            }
            
            // Continue spawning rapidly
            vsBalloonSpawnInterval = setInterval(() => {
                const activeBalloons = vsFlyingBalloons.filter(b => !b.popped).length;
                // Always keep at least 20 balloons, spawn more if less
                if (activeBalloons < 25) {
                    spawnVsFlyingBalloon();
                    spawnVsFlyingBalloon(); // Spawn 2 at a time
                }
            }, 400);
            
            // Start animation loop
            animateAllBalloons();
        }
        
        function spawnVsFlyingBalloon() {
            const area = document.getElementById('vsBalloonArea');
            if (!area || gameMode !== 'versus') return;
            
            const balloon = document.createElement('div');
            balloon.className = 'vs-flying-balloon';
            
            // Random balloon type
            const rand = Math.random();
            let type, value, colorClass;
            
            if (rand < 0.10) {
                type = 'bomb';
                value = 0;
                colorClass = 'bomb';
            } else if (rand < 0.18) {
                type = 'bonus';
                value = 20;
                colorClass = 'green';
            } else if (rand < 0.35) {
                type = 'special';
                value = [5, 10, 15][Math.floor(Math.random() * 3)];
                colorClass = 'light-blue';
            } else {
                type = 'normal';
                value = [5, 10, 15, 20][Math.floor(Math.random() * 4)];
                colorClass = 'yellow';
            }
            
            balloon.innerHTML = `
                <div class="vs-balloon-body ${colorClass}">${type === 'bomb' ? 'ðŸ’£' : value}</div>
                <div class="vs-balloon-knot"></div>
            `;
            
            // CENTER AREA ONLY - avoid player panels (200px on each side)
            const centerLeft = 200;
            const centerRight = window.innerWidth - 200;
            const centerWidth = centerRight - centerLeft;
            
            // Spawn from bottom only, in center area
            const startX = centerLeft + Math.random() * centerWidth;
            const startY = window.innerHeight + 50 + Math.random() * 100;
            
            balloon.style.left = startX + 'px';
            balloon.style.top = startY + 'px';
            
            area.appendChild(balloon);
            
            const balloonData = {
                element: balloon,
                type: type,
                value: value,
                popped: false,
                x: startX,
                y: startY,
                speedX: (Math.random() - 0.5) * 2,
                speedY: -1.2 - Math.random() * 1.8,
                wobble: Math.random() * Math.PI * 2,
                wobbleSpeed: 0.02 + Math.random() * 0.03,
                // Boundary limits for center area
                minX: centerLeft,
                maxX: centerRight - 70
            };
            
            vsFlyingBalloons.push(balloonData);
        }
        
        function animateAllBalloons() {
            if (!vsAnimationRunning || gameMode !== 'versus') return;
            
            vsFlyingBalloons.forEach(balloonData => {
                if (balloonData.popped) return;
                
                balloonData.wobble += balloonData.wobbleSpeed;
                balloonData.x += balloonData.speedX + Math.sin(balloonData.wobble) * 1;
                balloonData.y += balloonData.speedY;
                
                // Keep balloons in CENTER AREA only
                if (balloonData.x < balloonData.minX) {
                    balloonData.x = balloonData.minX;
                    balloonData.speedX = Math.abs(balloonData.speedX);
                }
                if (balloonData.x > balloonData.maxX) {
                    balloonData.x = balloonData.maxX;
                    balloonData.speedX = -Math.abs(balloonData.speedX);
                }
                
                balloonData.element.style.left = balloonData.x + 'px';
                balloonData.element.style.top = balloonData.y + 'px';
                
                // Remove if off screen (top)
                if (balloonData.y < -120) {
                    balloonData.popped = true;
                    balloonData.element.remove();
                }
            });
            
            // Clean up popped balloons from array periodically
            if (Math.random() < 0.1) {
                vsFlyingBalloons = vsFlyingBalloons.filter(b => !b.popped);
            }
            
            requestAnimationFrame(animateAllBalloons);
        }
        
        // FIXED POWER CONTROLS with cooldown
        function handleVsKeydown(e) {
            if (gameMode !== 'versus') return;
            
            // Player 1 uses Spacebar
            if (e.code === 'Space') {
                e.preventDefault();
                if (!p1Charging && !p1Cooldown) {
                    p1Charging = true;
                    p1Power = 0;
                    clearInterval(p1ChargeInterval);
                    
                    const p1Fill = document.getElementById('p1PowerFill');
                    const p1Percent = document.getElementById('p1PowerPercent');
                    
                    p1ChargeInterval = setInterval(() => {
                        p1Power = Math.min(p1Power + 3, 100);
                        if (p1Fill) p1Fill.style.width = p1Power + '%';
                        if (p1Percent) p1Percent.textContent = Math.round(p1Power) + '%';
                    }, 20);
                }
            }
            
            // Player 2 uses Enter key
            if (e.code === 'Enter') {
                e.preventDefault();
                if (!p2Charging && !p2Cooldown) {
                    p2Charging = true;
                    p2Power = 0;
                    clearInterval(p2ChargeInterval);
                    
                    const p2Fill = document.getElementById('p2PowerFill');
                    const p2Percent = document.getElementById('p2PowerPercent');
                    
                    p2ChargeInterval = setInterval(() => {
                        p2Power = Math.min(p2Power + 3, 100);
                        if (p2Fill) p2Fill.style.width = p2Power + '%';
                        if (p2Percent) p2Percent.textContent = Math.round(p2Power) + '%';
                    }, 20);
                }
            }
        }
        
        function handleVsKeyup(e) {
            if (gameMode !== 'versus') return;
            
            // Player 1 releases Space
            if (e.code === 'Space' && p1Charging) {
                e.preventDefault();
                clearInterval(p1ChargeInterval);
                p1ChargeInterval = null;
                
                // Cap power at 50% for rapid clicks (if released too quickly)
                let finalPower = p1Power;
                if (finalPower < 50) {
                    finalPower = Math.min(finalPower, 50); // Max 50% for quick release
                }
                
                if (finalPower >= 10) {
                    throwVsDartAtBalloon(1, finalPower);
                    // Set cooldown to prevent spam
                    p1Cooldown = true;
                    setTimeout(() => { p1Cooldown = false; }, 300); // 300ms cooldown
                }
                
                const p1Fill = document.getElementById('p1PowerFill');
                const p1Percent = document.getElementById('p1PowerPercent');
                if (p1Fill) p1Fill.style.width = '0%';
                if (p1Percent) p1Percent.textContent = '0%';
                p1Charging = false;
                p1Power = 0;
            }
            
            // Player 2 releases Enter
            if (e.code === 'Enter' && p2Charging) {
                e.preventDefault();
                clearInterval(p2ChargeInterval);
                p2ChargeInterval = null;
                
                // Cap power at 50% for rapid clicks (if released too quickly)
                let finalPower = p2Power;
                if (finalPower < 50) {
                    finalPower = Math.min(finalPower, 50); // Max 50% for quick release
                }
                
                if (finalPower >= 10) {
                    throwVsDartAtBalloon(2, finalPower);
                    // Set cooldown to prevent spam
                    p2Cooldown = true;
                    setTimeout(() => { p2Cooldown = false; }, 300); // 300ms cooldown
                }
                
                const p2Fill = document.getElementById('p2PowerFill');
                const p2Percent = document.getElementById('p2PowerPercent');
                if (p2Fill) p2Fill.style.width = '0%';
                if (p2Percent) p2Percent.textContent = '0%';
                p2Charging = false;
                p2Power = 0;
            }
        }
        
        // Keep mouse handlers for backwards compatibility but disabled
        function handleVsMouseDown(e) {
            // Disabled - using keyboard controls
        }
        
        function handleVsMouseUp(e) {
            // Disabled - using keyboard controls
        }
        
        function throwVsDartAtBalloon(player, power) {
            playSound('throw');
            
            // Hide dart in cannon
            const cannonDart = document.getElementById(player === 1 ? 'p1CannonDart' : 'p2CannonDart');
            if (cannonDart) cannonDart.classList.add('hidden');
            
            // Create dart projectile
            const dart = document.createElement('img');
            dart.className = 'vs-dart-projectile';
            dart.src = player === 1 ? 'dart-p1.png' : 'dart-p2.png';
            dart.alt = 'dart';
            dart.style.width = '70px';
            
            // Start from cannon position
            const cannon = document.getElementById(player === 1 ? 'p1Cannon' : 'p2Cannon');
            const cannonRect = cannon.getBoundingClientRect();
            const startX = cannonRect.left + cannonRect.width / 2 - 35;
            const startY = cannonRect.top - 30;
            
            // Get balloon area (center of screen)
            const vsBalloonArea = document.getElementById('vsBalloonArea');
            const balloonAreaRect = vsBalloonArea ? vsBalloonArea.getBoundingClientRect() : null;
            const screenCenterX = window.innerWidth / 2;
            
            // Power determines where dart lands in the balloon area
            // Low power = bottom/outer, High power = top/center
            // Target X: moves toward center based on power
            // Target Y: higher power = higher on screen (lower Y value)
            
            const balloonAreaTop = balloonAreaRect ? balloonAreaRect.top : 100;
            const balloonAreaBottom = balloonAreaRect ? balloonAreaRect.bottom : window.innerHeight - 200;
            const balloonAreaHeight = balloonAreaBottom - balloonAreaTop;
            
            // Calculate target position based on power
            // Y position: 10% power = bottom of balloon area, 100% power = top
            const targetY = balloonAreaBottom - (power / 100) * balloonAreaHeight;
            
            // X position: dart travels toward center
            // P1 (left): travels right toward center
            // P2 (right): travels left toward center
            const travelTowardCenter = (power / 100) * (screenCenterX - startX);
            const targetX = player === 1 ? 
                startX + Math.abs(travelTowardCenter) : // P1 moves right
                startX - Math.abs(screenCenterX - startX) * (power / 100); // P2 moves left
            
            // Dart rotation - point toward target
            const angle = Math.atan2(targetY - startY, targetX - startX) * (180 / Math.PI) + 90;
            dart.style.transform = `rotate(${angle}deg)`;
            
            dart.style.left = startX + 'px';
            dart.style.top = startY + 'px';
            document.getElementById('gameScreen').appendChild(dart);
            
            const duration = 400;
            const startTime = Date.now();
            let hitBalloon = null;
            
            function animateDart() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3);
                
                // Move diagonally toward target
                const currentX = startX + (targetX - startX) * eased;
                const currentY = startY + (targetY - startY) * eased;
                dart.style.left = currentX + 'px';
                dart.style.top = currentY + 'px';
                
                // Check if dart hits any balloon during flight
                if (!hitBalloon) {
                    const dartRect = dart.getBoundingClientRect();
                    const dartCenterX = dartRect.left + dartRect.width / 2;
                    const dartCenterY = dartRect.top + dartRect.height / 2;
                    
                    for (const balloon of vsFlyingBalloons) {
                        if (balloon.popped) continue;
                        const balloonRect = balloon.element.getBoundingClientRect();
                        const balloonCenterX = balloonRect.left + balloonRect.width / 2;
                        const balloonCenterY = balloonRect.top + balloonRect.height / 2;
                        
                        const dist = Math.sqrt(
                            Math.pow(dartCenterX - balloonCenterX, 2) + 
                            Math.pow(dartCenterY - balloonCenterY, 2)
                        );
                        
                        if (dist < 60) { // Hit radius
                            hitBalloon = balloon;
                            handleVsFlyingBalloonHit(player, balloon);
                            break;
                        }
                    }
                }
                
                if (progress < 1) {
                    requestAnimationFrame(animateDart);
                } else {
                    dart.remove();
                    reloadCannonDart(player);
                }
            }
            animateDart();
        }
        
        function reloadCannonDart(player) {
            const cannonDart = document.getElementById(player === 1 ? 'p1CannonDart' : 'p2CannonDart');
            if (cannonDart) {
                cannonDart.classList.remove('hidden');
                cannonDart.classList.add('reloading');
                setTimeout(() => cannonDart.classList.remove('reloading'), 300);
            }
        }
        
        function createBalloonSplash(x, y, color) {
            const splash = document.createElement('div');
            splash.className = 'balloon-splash';
            splash.style.left = x + 'px';
            splash.style.top = y + 'px';
            
            // Create multiple particles
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'splash-particle';
                particle.style.background = color;
                const angle = (i / 12) * Math.PI * 2;
                const distance = 40 + Math.random() * 40;
                particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                splash.appendChild(particle);
            }
            
            document.getElementById('gameScreen').appendChild(splash);
            setTimeout(() => splash.remove(), 600);
        }
        
        function handleVsFlyingBalloonHit(player, balloon) {
            if (balloon.popped) return;
            balloon.popped = true;
            balloon.element.classList.add('popped');
            playSound('pop');
            
            const rect = balloon.element.getBoundingClientRect();
            const popX = rect.left + rect.width / 2;
            const popY = rect.top + rect.height / 2;
            
            createSplash(popX, popY, balloon.type === 'bomb' ? '#333' : '#FFD700');
            
            // Create colorful splash effect
            const splashColor = balloon.type === 'bomb' ? '#FF4500' : 
                               balloon.type === 'bonus' ? '#32CD32' : '#FFD700';
            createBalloonSplash(popX, popY, splashColor);
            
            if (balloon.type === 'bomb') {
                playSound('bomb');
                // Bomb reduces score by 30
                if (player === 1) p1Score = Math.max(0, p1Score - 30);
                else p2Score = Math.max(0, p2Score - 30);
                showScorePopup('-30', popX, popY, 'negative');
                createExplosion(popX, popY, 'bomb');
            } else {
                const points = balloon.value;
                if (player === 1) p1Score += points;
                else p2Score += points;
                showScorePopup('+' + points, popX, popY, balloon.type === 'bonus' ? 'bonus' : 'normal');
                if (points >= 15) createFirework(popX, popY);
            }
            
            updateVsHud();
            setTimeout(() => balloon.element.remove(), 300);
        }
        
        function endVsGame() {
            clearInterval(gameTimer);
            clearInterval(vsBalloonSpawnInterval);
            document.removeEventListener('keydown', handleVsKeydown);
            document.removeEventListener('keyup', handleVsKeyup);
            document.removeEventListener('mousedown', handleVsMouseDown);
            document.removeEventListener('mouseup', handleVsMouseUp);
            
            const t = translations[currentLang];
            const gameOverTitleEl = document.getElementById('gameOverTitle');
            const finalScoreEl = document.getElementById('finalScore');
            
            if (gameOverTitleEl) {
                if (p1Score > p2Score) gameOverTitleEl.textContent = t.p1Wins;
                else if (p2Score > p1Score) gameOverTitleEl.textContent = t.p2Wins;
                else gameOverTitleEl.textContent = t.tie;
            }
            if (finalScoreEl) finalScoreEl.textContent = `P1: ${p1Score} | P2: ${p2Score}`;
            
            const gameOverScreen = document.getElementById('gameOverScreen');
            if (gameOverScreen) gameOverScreen.classList.add('active');
        }
        
        function updateVsHud() {
            const p1ScoreEl = document.getElementById('p1Score');
            const p2ScoreEl = document.getElementById('p2Score');
            
            if (p1ScoreEl) p1ScoreEl.textContent = p1Score;
            if (p2ScoreEl) p2ScoreEl.textContent = p2Score;
        }
        
        function handleMouseMove(e) {
            mouseX = e.clientX; mouseY = e.clientY;
            // No crosshair movement - removed for power-based throwing
        }
        
        function handleMouseDown(e) {
            // Don't charge if clicking on buttons
            if (e.target.closest('.back-to-menu') || e.target.closest('.music-toggle') || e.target.closest('button')) {
                return;
            }
            startCharging();
        }
        
        function handleMouseUp(e) {
            releaseCharge();
        }
        
        function handleKeyDownClassic(e) {
            if (gameMode === 'versus') return; // VS mode has its own handler
            if (e.code === 'Space') {
                e.preventDefault();
                startCharging();
            }
        }
        
        function handleKeyUpClassic(e) {
            if (gameMode === 'versus') return;
            if (e.code === 'Space') {
                e.preventDefault();
                releaseCharge();
            }
        }
        
        function startCharging() {
            if (isThrowingDart || dartsRemaining <= 0 || isPowerCharging) return;
            isPowerCharging = true;
            powerLevel = 0;
            
            // Animate capybara charging
            const capybara = document.getElementById('capybaraHolder');
            if (capybara) capybara.classList.add('charging');
            
            // Update instruction
            const instruction = document.getElementById('chargeInstruction');
            if (instruction) instruction.textContent = currentLang === 'en' ? 'âš¡ CHARGING...' : 'âš¡ è“„åŠ›ä¸­...';
            
            powerInterval = setInterval(() => {
                powerLevel = Math.min(powerLevel + 2, 100);
                document.getElementById('powerFill').style.width = powerLevel + '%';
            }, 20);
        }
        
        function releaseCharge() {
            if (!isPowerCharging) return;
            isPowerCharging = false;
            clearInterval(powerInterval);
            
            // Animate capybara throwing
            const capybara = document.getElementById('capybaraHolder');
            if (capybara) {
                capybara.classList.remove('charging');
                if (powerLevel >= 20) {
                    capybara.classList.add('throwing');
                    setTimeout(() => capybara.classList.remove('throwing'), 300);
                }
            }
            
            // Reset instruction
            const instruction = document.getElementById('chargeInstruction');
            if (instruction) instruction.textContent = currentLang === 'en' ? 'âŒ¨ï¸ HOLD SPACE' : 'âŒ¨ï¸ æŒ‰ä½ç©ºç™½éµ';
            
            if (powerLevel >= 20) throwDartAtPosition(mouseX, mouseY, powerLevel);
            document.getElementById('powerFill').style.width = '0%';
            powerLevel = 0;
        }
        
        function createDecorations() {
            const lightsContainer = document.getElementById('stringLights');
            lightsContainer.innerHTML = '';
            const lightColors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3', '#DDA0DD', '#87CEEB'];
            for (let i = 0; i < 25; i++) {
                const light = document.createElement('div');
                light.className = 'light-bulb';
                light.style.left = (i * 4.2) + '%';
                light.style.top = (Math.sin(i * 0.5) * 8 + 8) + 'px';
                light.style.background = lightColors[i % lightColors.length];
                light.style.animationDelay = (i * 0.1) + 's';
                lightsContainer.appendChild(light);
            }
            
            const toyShelf = document.getElementById('toyShelf');
            toyShelf.innerHTML = '';
            ['ðŸ§¸', 'ðŸ»', 'ðŸ¦', 'ðŸ°', 'ðŸ¼', 'ðŸ¦Š', 'ðŸ¶', 'ðŸ±', 'ðŸ¦„', 'ðŸ˜', 'ðŸ¦’', 'ðŸµ', 'ðŸ·', 'ðŸŒŸ', 'ðŸŽ'].forEach((toy, i) => {
                const el = document.createElement('div');
                el.className = 'stuffed-toy';
                el.textContent = toy;
                el.style.animationDelay = (i * 0.1) + 's';
                toyShelf.appendChild(el);
            });
            
            const leftPrizes = document.getElementById('leftPrizes');
            const rightPrizes = document.getElementById('rightPrizes');
            leftPrizes.innerHTML = ''; rightPrizes.innerHTML = '';
            ['ðŸ§¸', 'ðŸŽ', 'ðŸŒŸ', 'ðŸ¦„', 'ðŸŽ€', 'ðŸ†'].forEach(t => { const el = document.createElement('div'); el.className = 'prize-toy'; el.textContent = t; leftPrizes.appendChild(el); });
            ['ðŸ»', 'ðŸŽª', 'â­', 'ðŸŽˆ', 'ðŸŽŠ', 'ðŸ¥‡'].forEach(t => { const el = document.createElement('div'); el.className = 'prize-toy'; el.textContent = t; rightPrizes.appendChild(el); });
        }
        
        function createBalloons() {
            const container = document.getElementById('balloonContainer');
            container.innerHTML = ''; balloons = [];
            const centerX = 240, centerY = 240, balloonSize = 50, balloonOffset = balloonSize / 2;
            
            // VS Mode - create red and blue balloons
            if (gameMode === 'versus') {
                createVsBalloons(container, centerX, centerY, balloonSize, balloonOffset);
                return;
            }
            
            const colors = ['balloon-1', 'balloon-2', 'balloon-3', 'balloon-4', 'balloon-5', 'balloon-6'];
            
            // Fill the dartboard with balloons - 480px container, center at 240,240
            const rings = [
                { count: 20, radius: 200 }, 
                { count: 16, radius: 165 }, 
                { count: 14, radius: 130 },
                { count: 10, radius: 95 }, 
                { count: 8, radius: 60 },
                { count: 4, radius: 30 }
            ];
            
            let balloonIndex = 0;
            const totalBalloons = 72; // Sum of all rings
            
            // More bombs for timeToAttack mode
            const isTimeToAttack = gameMode === 'timeToAttack';
            const bombCount = isTimeToAttack ? 15 : 6;
            const starCount = 4, freezeCount = 3, multiplierCount = 3, goldCount = 3;
            
            const specialIndices = { bomb: new Set(), star: new Set(), freeze: new Set(), multiplier: new Set(), gold: new Set() };
            while (specialIndices.bomb.size < bombCount) specialIndices.bomb.add(Math.floor(Math.random() * totalBalloons));
            while (specialIndices.star.size < starCount) { const idx = Math.floor(Math.random() * totalBalloons); if (!specialIndices.bomb.has(idx)) specialIndices.star.add(idx); }
            while (specialIndices.freeze.size < freezeCount) { const idx = Math.floor(Math.random() * totalBalloons); if (!specialIndices.bomb.has(idx) && !specialIndices.star.has(idx)) specialIndices.freeze.add(idx); }
            while (specialIndices.multiplier.size < multiplierCount) { const idx = Math.floor(Math.random() * totalBalloons); if (!specialIndices.bomb.has(idx) && !specialIndices.star.has(idx) && !specialIndices.freeze.has(idx)) specialIndices.multiplier.add(idx); }
            while (specialIndices.gold.size < goldCount) { const idx = Math.floor(Math.random() * totalBalloons); if (!specialIndices.bomb.has(idx) && !specialIndices.star.has(idx) && !specialIndices.freeze.has(idx) && !specialIndices.multiplier.has(idx)) specialIndices.gold.add(idx); }
            
            rings.forEach((ring, ringIndex) => {
                const angleStep = (Math.PI * 2) / ring.count;
                const startAngle = (ringIndex % 2) * (angleStep / 2);
                for (let i = 0; i < ring.count; i++) {
                    if (balloonIndex >= totalBalloons) break;
                    const angle = startAngle + i * angleStep;
                    const x = centerX + Math.cos(angle) * ring.radius;
                    const y = centerY + Math.sin(angle) * ring.radius;
                    const balloon = document.createElement('div');
                    balloon.className = 'balloon ' + colors[balloonIndex % colors.length];
                    balloon.style.left = (x - balloonOffset) + 'px';
                    balloon.style.top = (y - balloonOffset) + 'px';
                    
                    let value, type = 'normal';
                    if (specialIndices.bomb.has(balloonIndex)) { type = 'bomb'; value = -30; balloon.classList.add('bomb'); balloon.textContent = 'ðŸ’£'; }
                    else if (specialIndices.star.has(balloonIndex)) { type = 'star'; value = 25; balloon.classList.add('star'); balloon.textContent = 'â­'; }
                    else if (specialIndices.freeze.has(balloonIndex)) { type = 'freeze'; value = 15; balloon.classList.add('freeze'); balloon.textContent = 'â„'; }
                    else if (specialIndices.multiplier.has(balloonIndex)) { type = 'multiplier'; value = 10; balloon.classList.add('multiplier'); balloon.textContent = '2x'; }
                    else if (specialIndices.gold.has(balloonIndex)) { type = 'gold'; value = 20; balloon.classList.add('gold'); balloon.textContent = '20'; }
                    else { value = [5, 10, 15][Math.floor(Math.random() * 3)]; balloon.textContent = value; }
                    
                    balloon.dataset.index = balloonIndex;
                    container.appendChild(balloon);
                    balloons.push({ element: balloon, value: value, type: type, popped: false, x: x, y: y, color: 'normal' });
                    balloonIndex++;
                }
            });
            
            updateDartDisplay();
        }
        
        function createVsBalloons(container, centerX, centerY, balloonSize, balloonOffset) {
            // VS Mode balloons - 60px size, red for P1, blue for P2, plus bombs and freeze
            const vsBalloonSize = 60;
            const vsBalloonOffset = vsBalloonSize / 2;
            
            const rings = [
                { count: 12, radius: 190 }, 
                { count: 10, radius: 145 }, 
                { count: 8, radius: 100 },
                { count: 5, radius: 55 }
            ];
            
            let balloonIndex = 0;
            const totalBalloons = 35;
            
            // Distribute special balloons
            const bombCount = 4, freezeCount = 3;
            const specialIndices = { bomb: new Set(), freeze: new Set() };
            while (specialIndices.bomb.size < bombCount) specialIndices.bomb.add(Math.floor(Math.random() * totalBalloons));
            while (specialIndices.freeze.size < freezeCount) { 
                const idx = Math.floor(Math.random() * totalBalloons); 
                if (!specialIndices.bomb.has(idx)) specialIndices.freeze.add(idx); 
            }
            
            rings.forEach((ring, ringIndex) => {
                const angleStep = (Math.PI * 2) / ring.count;
                const startAngle = (ringIndex % 2) * (angleStep / 2);
                for (let i = 0; i < ring.count; i++) {
                    if (balloonIndex >= totalBalloons) break;
                    const angle = startAngle + i * angleStep;
                    const x = centerX + Math.cos(angle) * ring.radius;
                    const y = centerY + Math.sin(angle) * ring.radius;
                    const balloon = document.createElement('div');
                    balloon.style.left = (x - vsBalloonOffset) + 'px';
                    balloon.style.top = (y - vsBalloonOffset) + 'px';
                    balloon.style.width = vsBalloonSize + 'px';
                    balloon.style.height = vsBalloonSize + 'px';
                    balloon.style.fontSize = '18px';
                    
                    let value, type = 'normal', color = 'normal';
                    
                    if (specialIndices.bomb.has(balloonIndex)) { 
                        type = 'bomb'; value = 0; color = 'bomb';
                        balloon.className = 'balloon bomb'; 
                        balloon.textContent = 'ðŸ’£'; 
                    }
                    else if (specialIndices.freeze.has(balloonIndex)) { 
                        type = 'freeze'; value = 0; color = 'freeze';
                        balloon.className = 'balloon freeze'; 
                        balloon.textContent = 'â„ï¸'; 
                    }
                    else {
                        // Alternate red and blue balloons
                        const isRed = balloonIndex % 2 === 0;
                        color = isRed ? 'red' : 'blue';
                        value = [5, 10, 15][Math.floor(Math.random() * 3)];
                        balloon.className = 'balloon ' + (isRed ? 'red-balloon' : 'blue-balloon');
                        balloon.textContent = value;
                    }
                    
                    balloon.dataset.index = balloonIndex;
                    container.appendChild(balloon);
                    balloons.push({ element: balloon, value: value, type: type, popped: false, x: x, y: y, color: color, originalIndex: balloonIndex });
                    balloonIndex++;
                }
            });
            
            updateDartDisplay();
        }
        
        // Respawn a balloon in VS mode
        function respawnVsBalloon() {
            if (gameMode !== 'versus') return;
            
            const container = document.getElementById('balloonContainer');
            const centerX = 240, centerY = 240;
            const vsBalloonSize = 60;
            const vsBalloonOffset = vsBalloonSize / 2;
            
            // Find a random position
            const rings = [190, 145, 100, 55];
            const ring = rings[Math.floor(Math.random() * rings.length)];
            const angle = Math.random() * Math.PI * 2;
            const x = centerX + Math.cos(angle) * ring;
            const y = centerY + Math.sin(angle) * ring;
            
            const balloon = document.createElement('div');
            balloon.style.left = (x - vsBalloonOffset) + 'px';
            balloon.style.top = (y - vsBalloonOffset) + 'px';
            balloon.style.width = vsBalloonSize + 'px';
            balloon.style.height = vsBalloonSize + 'px';
            balloon.style.fontSize = '18px';
            balloon.style.animation = 'popIn 0.3s ease-out';
            
            // Random balloon type
            const rand = Math.random();
            let value, type = 'normal', color = 'normal';
            
            if (rand < 0.08) { // 8% bomb
                type = 'bomb'; value = 0; color = 'bomb';
                balloon.className = 'balloon bomb'; 
                balloon.textContent = 'ðŸ’£'; 
            } else if (rand < 0.14) { // 6% freeze
                type = 'freeze'; value = 0; color = 'freeze';
                balloon.className = 'balloon freeze'; 
                balloon.textContent = 'â„ï¸'; 
            } else {
                const isRed = Math.random() < 0.5;
                color = isRed ? 'red' : 'blue';
                value = [5, 10, 15][Math.floor(Math.random() * 3)];
                balloon.className = 'balloon ' + (isRed ? 'red-balloon' : 'blue-balloon');
                balloon.textContent = value;
            }
            
            balloon.dataset.index = balloons.length;
            container.appendChild(balloon);
            balloons.push({ element: balloon, value: value, type: type, popped: false, x: x, y: y, color: color });
        }
        
        function updateDartDisplay() {
            // Update dart count in the holder
            const dartCountHud = document.getElementById('dartCountHud');
            if (dartCountHud) {
                let dartsToShow = gameMode === 'versus' ? 
                    (currentPlayer === 1 ? p1Darts : p2Darts) : dartsRemaining;
                dartCountHud.textContent = dartsToShow;
            }
            
            // Hide dart if no darts left
            const currentDart = document.getElementById('currentDart');
            if (currentDart) {
                if (dartsRemaining <= 0) {
                    currentDart.style.opacity = '0.3';
                } else {
                    currentDart.style.opacity = '1';
                }
            }
        }
        
        // Firework effect function
        function createFirework(x, y, color) {
            const colors = color ? [color] : ['#FFD700', '#FF6B6B', '#4ECDC4', '#FF69B4', '#00BFFF'];
            const particleCount = 12;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                const angle = (i / particleCount) * Math.PI * 2;
                const distance = 30 + Math.random() * 40;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                particle.style.animation = `fireworkExplode 0.6s ease-out forwards`;
                particle.style.transform = `translate(${tx}px, ${ty}px)`;
                
                document.getElementById('gameScreen').appendChild(particle);
                setTimeout(() => particle.remove(), 600);
            }
        }
        
        // Splash effect when balloon pops
        function createSplash(x, y, color) {
            const particleCount = 8;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'splash-particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = color || '#FFD700';
                
                const angle = (i / particleCount) * Math.PI * 2;
                const distance = 20 + Math.random() * 30;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                
                document.getElementById('gameScreen').appendChild(particle);
                setTimeout(() => particle.remove(), 500);
            }
        }
        
        function startRotation() {
            const board = document.getElementById('rotatingBoard');
            board.style.animation = 'none';
            board.offsetHeight;
            board.style.animation = `rotateBoard ${isFrozen ? '999999' : '12'}s linear infinite`;
        }
        
        function startTimer() {
            gameTimer = setInterval(() => {
                timeRemaining--;
                document.getElementById('timerFill').style.width = (timeRemaining / 60 * 100) + '%';
                if (timeRemaining <= 0) { clearInterval(gameTimer); endGame(); }
            }, 1000);
        }
        
        function createFloatingBalloons() {
            const container = document.getElementById('bgBalloons');
            bgBalloonInterval = setInterval(() => {
                if (document.getElementById('gameScreen').classList.contains('active')) {
                    const balloon = document.createElement('div');
                    balloon.className = 'bg-balloon';
                    balloon.textContent = 'ðŸŽˆ';
                    balloon.style.left = Math.random() * 100 + '%';
                    balloon.style.animationDuration = (6 + Math.random() * 4) + 's';
                    balloon.style.filter = `hue-rotate(${Math.random() * 360}deg)`;
                    container.appendChild(balloon);
                    setTimeout(() => balloon.remove(), 12000);
                }
            }, 1000);
        }
        
        function throwDartAtPosition(targetX, targetY, power) {
            if (dartsRemaining <= 0 || isThrowingDart) return;
            isThrowingDart = true;
            dartsRemaining--;
            dartsThrown++;
            
            if (gameMode === 'versus') {
                if (currentPlayer === 1) p1Darts--; else p2Darts--;
            }
            
            // Hide current dart in holder
            const currentDart = document.getElementById('currentDart');
            if (currentDart) currentDart.classList.add('thrown');
            
            updateHUD();
            updateDartDisplay();
            playSound('throw');
            
            // Get dartboard position
            const dartboardArea = document.querySelector('.dartboard-area');
            const dartboardRect = dartboardArea.getBoundingClientRect();
            const dartboardTop = dartboardRect.top;
            const dartboardBottom = dartboardRect.bottom;
            const dartboardCenterX = dartboardRect.left + dartboardRect.width / 2;
            
            const dart = document.createElement('div');
            dart.className = 'dart-projectile';
            dart.innerHTML = '<img src="dart.png" alt="dart">';
            
            // Start from capybara position at bottom center
            const capybaraHolder = document.getElementById('capybaraHolder');
            const capybaraRect = capybaraHolder ? capybaraHolder.getBoundingClientRect() : null;
            const startX = dartboardCenterX - 40; // Center with dartboard
            const startY = capybaraRect ? capybaraRect.top - 30 : window.innerHeight - 150;
            
            // Power determines WHERE on dartboard dart hits (straight up movement)
            // 10% = bottom of dartboard, 100% = top of dartboard
            // Map power to dartboard Y position:
            // Low power (10-30%) = bottom area of dartboard
            // Medium power (40-60%) = middle area
            // High power (70-100%) = top area
            const dartboardHeight = dartboardBottom - dartboardTop;
            const hitY = dartboardBottom - (power / 100) * dartboardHeight; // Higher power = higher on board
            
            dart.style.left = startX + 'px'; 
            dart.style.top = startY + 'px';
            document.getElementById('gameScreen').appendChild(dart);
            
            // Dart points straight up
            const dartImg = dart.querySelector('img');
            if (dartImg) dartImg.style.transform = 'rotate(0deg)';
            
            const duration = 350, startTime = Date.now();
            let hitBalloon = null;
            
            function animateDart() {
                const elapsed = Date.now() - startTime, progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3);
                
                // Move STRAIGHT UP - X stays same (centered), Y goes up based on power
                const currentY = startY + (hitY - startY) * eased;
                dart.style.top = currentY + 'px';
                
                // Check for balloon hits during flight
                if (!hitBalloon) {
                    const dartRect = dart.getBoundingClientRect();
                    const dartCenterX = dartRect.left + dartRect.width / 2;
                    const dartCenterY = dartRect.top + dartRect.height / 2;
                    
                    // Check against dartboard balloons
                    const board = document.getElementById('rotatingBoard');
                    const style = window.getComputedStyle(board), matrix = style.transform;
                    let boardAngle = 0;
                    if (matrix !== 'none') { 
                        const v = matrix.split('(')[1].split(')')[0].split(','); 
                        boardAngle = Math.atan2(parseFloat(v[1]), parseFloat(v[0])); 
                    }
                    
                    const rect = dartboardArea.getBoundingClientRect();
                    const screenCenterX = rect.left + rect.width / 2;
                    const screenCenterY = rect.top + rect.height / 2;
                    const boardCenter = 300;
                    
                    for (const balloon of balloons) {
                        if (balloon.popped) continue;
                        const relX = balloon.x - boardCenter, relY = balloon.y - boardCenter;
                        const rotatedX = screenCenterX + (relX * Math.cos(boardAngle) - relY * Math.sin(boardAngle));
                        const rotatedY = screenCenterY + (relX * Math.sin(boardAngle) + relY * Math.cos(boardAngle));
                        
                        const dist = Math.sqrt(Math.pow(dartCenterX - rotatedX, 2) + Math.pow(dartCenterY - rotatedY, 2));
                        if (dist < 65) { // Hit radius
                            hitBalloon = balloon;
                            popBalloon(balloon);
                            break;
                        }
                    }
                }
                
                if (progress < 1) {
                    requestAnimationFrame(animateDart);
                } else {
                    dart.remove();
                    isThrowingDart = false;
                    
                    // Reload dart animation
                    if (currentDart && dartsRemaining > 0) {
                        currentDart.classList.remove('thrown');
                        currentDart.classList.add('reloading');
                        setTimeout(() => currentDart.classList.remove('reloading'), 300);
                    }
                    
                    checkGameEnd();
                }
            }
            animateDart();
        }
        
        function checkHit(x, y) {
            const board = document.getElementById('rotatingBoard');
            const style = window.getComputedStyle(board), matrix = style.transform;
            let boardAngle = 0;
            if (matrix !== 'none') { const v = matrix.split('(')[1].split(')')[0].split(','); boardAngle = Math.atan2(parseFloat(v[1]), parseFloat(v[0])); }
            
            const dartboardArea = document.querySelector('.dartboard-area');
            const rect = dartboardArea.getBoundingClientRect();
            const screenCenterX = rect.left + rect.width / 2, screenCenterY = rect.top + rect.height / 2;
            const boardCenter = 300; // Center of 600px board
            
            let closestBalloon = null, closestDist = 60; // Increased from 40 to 60 for better hit detection
            balloons.forEach(balloon => {
                if (balloon.popped) return;
                const relX = balloon.x - boardCenter, relY = balloon.y - boardCenter;
                const rotatedX = screenCenterX + (relX * Math.cos(boardAngle) - relY * Math.sin(boardAngle));
                const rotatedY = screenCenterY + (relX * Math.sin(boardAngle) + relY * Math.cos(boardAngle));
                const dist = Math.sqrt(Math.pow(x - rotatedX, 2) + Math.pow(y - rotatedY, 2));
                if (dist < closestDist) { closestDist = dist; closestBalloon = balloon; }
            });
            
            if (closestBalloon) popBalloon(closestBalloon);
            else resetCombo();
        }
        
        function popBalloon(balloon) {
            if (balloon.popped) return;
            balloon.popped = true;
            balloon.element.classList.add('popped');
            balloonsPopped++;
            
            const rect = balloon.element.getBoundingClientRect();
            const popX = rect.left + rect.width / 2, popY = rect.top + rect.height / 2;
            let points = balloon.value * multiplier;
            
            // Get balloon color for splash
            const balloonStyle = window.getComputedStyle(balloon.element);
            const balloonColor = balloon.type === 'bomb' ? '#FF4500' : 
                                 balloon.type === 'star' ? '#FF69B4' :
                                 balloon.type === 'freeze' ? '#00BFFF' :
                                 balloon.type === 'gold' ? '#FFD700' : '#FFD700';
            
            // Create splash effect
            createSplash(popX, popY, balloonColor);
            createBalloonSplash(popX, popY, balloonColor);
            
            switch (balloon.type) {
                case 'bomb':
                    playSound('bomb');
                    if (gameMode === 'versus') { if (currentPlayer === 1) p1Score += points; else p2Score += points; }
                    else { score += points; if (score < 0) score = 0; }
                    createExplosion(popX, popY, 'bomb');
                    shakeScreen();
                    showScorePopup(points, popX, popY, 'negative');
                    resetCombo();
                    if (gameMode === 'timeToAttack') { 
                        lives--; 
                        const livesEl = document.getElementById('livesValue');
                        if (livesEl) livesEl.textContent = lives;
                        if (lives <= 0) endGame(); 
                    }
                    break;
                case 'star':
                    playSound('special');
                    if (gameMode === 'versus') { if (currentPlayer === 1) p1Score += points; else p2Score += points; }
                    else score += points;
                    createExplosion(popX, popY, 'star');
                    createFirework(popX, popY); // Add firework for star!
                    showScorePopup(points, popX, popY, 'bonus');
                    incrementCombo();
                    chainPop(balloon);
                    break;
                case 'freeze':
                    playSound('special');
                    if (gameMode === 'versus') { if (currentPlayer === 1) p1Score += points; else p2Score += points; }
                    else score += points;
                    createExplosion(popX, popY, 'normal');
                    createFirework(popX, popY, '#00BFFF'); // Add blue firework
                    showScorePopup('â„ FREEZE!', popX, popY, 'bonus');
                    activateFreeze();
                    incrementCombo();
                    break;
                case 'multiplier':
                    playSound('special');
                    if (gameMode === 'versus') { if (currentPlayer === 1) p1Score += points; else p2Score += points; }
                    else score += points;
                    createExplosion(popX, popY, 'normal');
                    createFirework(popX, popY, '#9400D3'); // Add purple firework
                    multiplier = Math.min(multiplier + 1, 5);
                    showScorePopup(`${multiplier}x!`, popX, popY, 'bonus');
                    incrementCombo();
                    break;
                default:
                    playSound('pop');
                    if (gameMode === 'versus') { if (currentPlayer === 1) p1Score += points; else p2Score += points; }
                    else score += points;
                    createExplosion(popX, popY, 'normal');
                    if (balloon.type === 'gold') createFirework(popX, popY, '#FFD700'); // Firework for gold
                    showScorePopup(points, popX, popY, balloon.type === 'gold' ? 'bonus' : '');
                    incrementCombo();
            }
            
            createParticles(popX, popY, balloon.type === 'bomb' ? '#FF4500' : '#FFD700');
            updateHUD();
            setTimeout(() => balloon.element.remove(), 300);
        }
        
        function chainPop(starBalloon) {
            const nearby = balloons.filter(b => {
                if (b.popped || b === starBalloon) return false;
                return Math.sqrt(Math.pow(b.x - starBalloon.x, 2) + Math.pow(b.y - starBalloon.y, 2)) < 100 && b.type !== 'bomb';
            });
            nearby.slice(0, 5).forEach((b, i) => setTimeout(() => popBalloon(b), i * 100));
        }
        
        function activateFreeze() {
            isFrozen = true;
            document.getElementById('rotatingBoard').classList.add('frozen');
            document.getElementById('frozenOverlay').classList.add('active');
            clearTimeout(freezeTimer);
            freezeTimer = setTimeout(() => {
                isFrozen = false;
                document.getElementById('rotatingBoard').classList.remove('frozen');
                document.getElementById('frozenOverlay').classList.remove('active');
                startRotation();
            }, 5000);
        }
        
        function incrementCombo() {
            combo++;
            if (combo > bestCombo) bestCombo = combo;
            clearTimeout(comboTimer);
            comboTimer = setTimeout(resetCombo, 2000);
            if (combo >= 3) { playSound('combo'); document.getElementById('comboDisplay').classList.add('combo'); setTimeout(() => document.getElementById('comboDisplay').classList.remove('combo'), 300); }
            if (combo === 5 || combo === 10 || combo === 15 || combo === 20) showBigCombo(combo);
            updateHUD();
        }
        
        function resetCombo() { combo = 0; multiplier = 1; updateHUD(); }
        
        function showBigCombo(num) {
            const el = document.getElementById('bigCombo');
            el.textContent = `ðŸ”¥ COMBO x${num}! ðŸ”¥`;
            el.classList.remove('show'); void el.offsetWidth; el.classList.add('show');
        }
        
        function createExplosion(x, y, type) {
            const exp = document.createElement('div');
            exp.className = `explosion ${type}`;
            exp.style.left = x + 'px'; exp.style.top = y + 'px';
            document.getElementById('gameScreen').appendChild(exp);
            setTimeout(() => exp.remove(), 600);
        }
        
        function createParticles(x, y, color) {
            for (let i = 0; i < 8; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.background = color;
                const angle = (Math.PI * 2 * i) / 8, dist = 30 + Math.random() * 20;
                p.style.setProperty('--tx', Math.cos(angle) * dist + 'px');
                p.style.setProperty('--ty', Math.sin(angle) * dist + 'px');
                document.getElementById('gameScreen').appendChild(p);
                setTimeout(() => p.remove(), 500);
            }
        }
        
        function showScorePopup(text, x, y, type = '') {
            const popup = document.createElement('div');
            popup.className = `score-popup ${type}`;
            popup.textContent = typeof text === 'number' ? (text >= 0 ? '+' + text : text) : text;
            popup.style.left = x + 'px'; popup.style.top = y + 'px';
            document.getElementById('gameScreen').appendChild(popup);
            setTimeout(() => popup.remove(), 800);
        }
        
        function shakeScreen() {
            document.getElementById('gameContainer').classList.add('shake');
            setTimeout(() => document.getElementById('gameContainer').classList.remove('shake'), 300);
        }
        
        function updateHUD() {
            if (gameMode === 'versus') {
                updateVsHud();
            } else {
                const scoreEl = document.getElementById('scoreValue');
                const dartsEl = document.getElementById('dartsValue');
                if (scoreEl) scoreEl.textContent = score;
                if (dartsEl) dartsEl.textContent = gameMode === 'classic' ? dartsRemaining : (gameMode === 'timeToAttack' ? `â¤ï¸${lives}` : 'âˆž');
            }
            const comboEl = document.getElementById('comboValue');
            const bestEl = document.getElementById('bestCombo');
            if (comboEl) comboEl.textContent = combo > 1 ? `x${combo}` : 'x1';
            if (bestEl) bestEl.textContent = `x${bestCombo}`;
        }
        
        function checkGameEnd() {
            if (gameMode === 'classic' && dartsRemaining <= 0) { setTimeout(endGame, 500); return; }
            if (gameMode === 'timeToAttack' && lives <= 0) { endGame(); return; }
            if (gameMode === 'versus') {
                if (currentPlayer === 1 && p1Darts <= 0) { currentPlayer = 2; dartsRemaining = p2Darts; updateVsHud(); }
                else if (currentPlayer === 2 && p2Darts <= 0) { setTimeout(endGame, 500); }
            }
            
            const remaining = balloons.filter(b => !b.popped && b.type !== 'bomb').length;
            if (remaining === 0) setTimeout(endGame, 500);
        }
        
        function endGame() {
            clearInterval(gameTimer); clearInterval(bgBalloonInterval);
            clearTimeout(comboTimer); clearTimeout(freezeTimer);
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mousedown', handleMouseDown);
            document.removeEventListener('mouseup', handleMouseUp);
            const crosshair = document.getElementById('crosshair');
            if (crosshair) crosshair.style.display = 'none';
            
            const t = translations[currentLang];
            const gameOverTitleEl = document.getElementById('gameOverTitle');
            const finalScoreEl = document.getElementById('finalScore');
            const statsPoppedEl = document.getElementById('statsPopped');
            const statsBestComboEl = document.getElementById('statsBestCombo');
            const statsAccuracyEl = document.getElementById('statsAccuracy');
            const prizeWonEl = document.getElementById('prizeWon');
            
            if (gameMode === 'versus') {
                if (gameOverTitleEl) {
                    if (p1Score > p2Score) gameOverTitleEl.textContent = t.p1Wins;
                    else if (p2Score > p1Score) gameOverTitleEl.textContent = t.p2Wins;
                    else gameOverTitleEl.textContent = t.tie;
                }
                if (finalScoreEl) finalScoreEl.textContent = `P1: ${p1Score} | P2: ${p2Score}`;
            } else {
                if (gameOverTitleEl) gameOverTitleEl.textContent = t.gameOverTitle;
                if (finalScoreEl) finalScoreEl.textContent = score;
            }
            
            if (statsPoppedEl) statsPoppedEl.textContent = balloonsPopped;
            if (statsBestComboEl) statsBestComboEl.textContent = `x${bestCombo}`;
            if (statsAccuracyEl) statsAccuracyEl.textContent = dartsThrown > 0 ? Math.round((balloonsPopped / dartsThrown) * 100) + '%' : '0%';
            
            const finalScore = gameMode === 'versus' ? Math.max(p1Score, p2Score) : score;
            let prize = 'ðŸ­ ' + t.prizeName5;
            if (finalScore >= 1000) { prize = 'ðŸ‘‘ ' + t.prizeName1; createConfetti(); celebrateToys(); }
            else if (finalScore >= 500) { prize = 'ðŸ¥‡ ' + t.prizeName2; createConfetti(); }
            else if (finalScore >= 250) { prize = 'ðŸ¥ˆ ' + t.prizeName3; }
            else if (finalScore >= 100) { prize = 'ðŸ¥‰ ' + t.prizeName4; }
            
            if (prizeWonEl) prizeWonEl.textContent = 'ðŸ† ' + prize;
            const gameOverScreen = document.getElementById('gameOverScreen');
            if (gameOverScreen) gameOverScreen.classList.add('active');
        }
        
        function celebrateToys() {
            document.querySelectorAll('.stuffed-toy').forEach((toy, i) => {
                setTimeout(() => toy.classList.add('won'), i * 100);
            });
        }
        
        function createConfetti() {
            const colors = ['#e63946', '#FFD700', '#4169E1', '#32CD32', '#FF1493', '#4ECDC4'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const c = document.createElement('div');
                    c.className = 'confetti';
                    c.style.left = Math.random() * 100 + '%';
                    c.style.top = '-10px';
                    c.style.background = colors[Math.floor(Math.random() * colors.length)];
                    document.getElementById('gameScreen').appendChild(c);
                    setTimeout(() => c.remove(), 2500);
                }, i * 30);
            }
        }
        
        function restartGame() {
            document.getElementById('gameOverScreen').classList.remove('active');
            document.getElementById('bgBalloons').innerHTML = '';
            initializeGame();
        }
        
        // Confirm back to menu
        function confirmBackToMenu() {
            const msg = currentLang === 'en' ? 
                'Are you sure you want to quit? Your progress will be lost!' : 
                'ç¢ºå®šè¦é€€å‡ºå—Žï¼Ÿä½ çš„é€²åº¦å°‡æœƒä¸Ÿå¤±ï¼';
            if (confirm(msg)) {
                goToMenu();
            }
        }
        
        function goToMenu() {
            // Stop music and timers
            stopBackgroundMusic();
            if (gameTimer) { clearInterval(gameTimer); gameTimer = null; }
            if (freezeTimer) { clearTimeout(freezeTimer); freezeTimer = null; }
            if (bgBalloonInterval) { clearInterval(bgBalloonInterval); bgBalloonInterval = null; }
            if (powerInterval) { clearInterval(powerInterval); powerInterval = null; }
            if (p1ChargeInterval) { clearInterval(p1ChargeInterval); p1ChargeInterval = null; }
            if (p2ChargeInterval) { clearInterval(p2ChargeInterval); p2ChargeInterval = null; }
            if (p1FreezeTimer) { clearTimeout(p1FreezeTimer); p1FreezeTimer = null; }
            if (p2FreezeTimer) { clearTimeout(p2FreezeTimer); p2FreezeTimer = null; }
            if (vsBalloonSpawnInterval) { clearInterval(vsBalloonSpawnInterval); vsBalloonSpawnInterval = null; }
            vsAnimationRunning = false;
            
            // Reset power state
            isPowerCharging = false;
            powerLevel = 0;
            isThrowingDart = false;
            p1Charging = false;
            p2Charging = false;
            p1Frozen = false;
            p2Frozen = false;
            vsFlyingBalloons = [];
            
            // Reset power meter
            const powerFill = document.getElementById('powerFill');
            if (powerFill) powerFill.style.width = '0%';
            const p1PowerFill = document.getElementById('p1PowerFill');
            const p2PowerFill = document.getElementById('p2PowerFill');
            if (p1PowerFill) p1PowerFill.style.width = '0%';
            if (p2PowerFill) p2PowerFill.style.width = '0%';
            
            // Remove event listeners
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mousedown', handleMouseDown);
            document.removeEventListener('mouseup', handleMouseUp);
            document.removeEventListener('keydown', handleKeyDownClassic);
            document.removeEventListener('keyup', handleKeyUpClassic);
            document.removeEventListener('keydown', handleVsKeydown);
            document.removeEventListener('keyup', handleVsKeyup);
            document.removeEventListener('mousedown', handleVsMouseDown);
            document.removeEventListener('mouseup', handleVsMouseUp);
            
            // Hide crosshair and frozen overlays
            const crosshairEl = document.getElementById('crosshair');
            if (crosshairEl) crosshairEl.style.display = 'none';
            const p1FrozenOverlay = document.getElementById('p1FrozenOverlay');
            const p2FrozenOverlay = document.getElementById('p2FrozenOverlay');
            if (p1FrozenOverlay) p1FrozenOverlay.classList.remove('active');
            if (p2FrozenOverlay) p2FrozenOverlay.classList.remove('active');
            
            // Reset dartboard and VS balloon area
            const rotatingBoard = document.getElementById('rotatingBoard');
            if (rotatingBoard) rotatingBoard.classList.remove('vs-mode', 'frozen');
            const dartboardArea = document.getElementById('dartboardArea');
            const vsBalloonArea = document.getElementById('vsBalloonArea');
            if (dartboardArea) dartboardArea.style.display = 'block';
            if (vsBalloonArea) { vsBalloonArea.style.display = 'none'; vsBalloonArea.innerHTML = ''; }
            
            // Hide cannons
            const vsCannons = document.getElementById('vsCannons');
            if (vsCannons) vsCannons.style.display = 'none';
            
            // Hide game screens, show main menu
            const gameOverScreen = document.getElementById('gameOverScreen');
            const gameScreen = document.getElementById('gameScreen');
            const mainMenu = document.getElementById('mainMenu');
            const bgBalloons = document.getElementById('bgBalloons');
            const timerBar = document.getElementById('timerBar');
            
            if (gameOverScreen) gameOverScreen.classList.remove('active');
            if (gameScreen) gameScreen.classList.remove('active');
            if (mainMenu) mainMenu.style.display = 'flex';
            if (bgBalloons) bgBalloons.innerHTML = '';
            if (timerBar) timerBar.classList.remove('active');
            
            // Hide legends and game top bar
            const normalLegend = document.getElementById('normalLegend');
            const vsLegend = document.getElementById('vsLegend');
            const gameTopBar = document.getElementById('gameTopBar');
            if (normalLegend) normalLegend.style.display = 'none';
            if (vsLegend) vsLegend.style.display = 'none';
            if (gameTopBar) gameTopBar.style.display = 'none';
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        function stopBackgroundMusic() {
            musicPlaying = false;
            if (musicInterval) {
                clearTimeout(musicInterval);
                musicInterval = null;
            }
            const musicBtn = document.getElementById('musicToggle');
            if (musicBtn) {
                musicBtn.classList.add('muted');
                musicBtn.textContent = 'ðŸ”‡';
            }
        }
        
        const style = document.createElement('style');
        style.textContent = `@keyframes rotateBoard { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }`;
        document.head.appendChild(style);
        
        // Add back to menu button listener
        const backBtn = document.getElementById('backToMenuBtn');
        if (backBtn) {
            backBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                confirmBackToMenu();
            });
        }
        
        setLanguage('en');
    </script>
</body>
</html>
